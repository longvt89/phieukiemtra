<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phiếu Kiểm Tra Xe - PHI LONG AUTO</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            font-size: 12px;
            line-height: 1.3;
            color: #000;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 210mm;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        .form-content {
            padding: 15mm;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #000;
            padding-bottom: 10px;
        }

        .header-left h1 {
            font-size: 24px;
            font-weight: bold;
            font-style: italic;
            margin-bottom: 5px;
        }

        .form-number {
            font-size: 16px;
            font-weight: bold;
        }

        .header-right {
            text-align: right;
        }

        .logo {
            width: 80px;
            height: 60px;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 10px;
            text-align: center;
        }

        /* Customer Info */
        .customer-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 15px;
        }

        .info-group {
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            flex-wrap: wrap; /* Cho phép các mục xuống dòng nếu không đủ chỗ */
        }

        .info-group label {
            font-weight: bold;
            margin-right: 5px;
            white-space: nowrap;
        }

        .info-group .info-input {
            border: none;
            border-bottom: 1px dotted #000;
            flex-grow: 1;
            padding: 0 5px;
            font-size: 12px;
            min-width: 50px; /* Base min-width */
        }
        /* Chiều rộng tùy chỉnh cho các input cụ thể */
        .info-group .info-input.name-input {
            min-width: 150px; /* Họ tên */
        }
        .info-group .info-input.phone-email-input {
            min-width: 90px; /* Điện thoại, E-mail */
        }
        .info-group .info-input.datetime-input {
            min-width: 130px; /* Ngày giờ nhận/giao xe */
        }
        .info-group .info-input.car-type-input {
            min-width: 150px; /* Loại & kiểu xe */
        }
        .info-group .info-input.license-km-input {
            min-width: 90px; /* Biển số, Kilô-mét */
        }
        
        .info-group input[type="checkbox"] {
            width: 15px;
            height: 15px;
            margin-right: 5px;
            vertical-align: middle;
        }
        /* Điều chỉnh cho các dòng có nhiều input hơn */
        .info-group.inline-fields {
            align-items: flex-start; /* Để các label và input căn trên cùng dòng */
            display: flex; /* Đảm bảo là flex để quản lý nội dung tốt hơn */
            justify-content: space-between; /* Đẩy các nhóm label-input ra xa nhau */
            width: 100%; /* Chiếm toàn bộ chiều rộng có thể */
        }
        .info-group.inline-fields > div {
            display: flex;
            align-items: center;
        }
        .info-group.inline-fields label {
            margin-right: 5px;
        }
        .info-group.inline-fields .info-input {
            flex-shrink: 1; /* Cho phép input co lại nếu cần */
        }


        /* Main Content Grid */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 15px;
        }

        /* Tire Section */
        .tire-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .tire-diagram-container {
            position: relative;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .tire-diagram {
            position: relative;
            width: 200px;
            height: 280px;
            border: 2px solid #000;
            border-radius: 20px;
            background: #f9f9f9;
            z-index: 0;
            margin-right: 10px;
        }

        .tire-position {
            position: absolute;
            background: #333;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            justify-content: center;
            font-size: 10px;
            color: white;
            padding: 5px;
            box-sizing: border-box;
            z-index: 1;
        }

        /* Điều chỉnh vị trí các ô lốp */
        .tire-front-left { top: 20px; left: -10px; }
        .tire-front-right { top: 20px; right: -10px; }
        .tire-rear-left { bottom: 20px; left: -10px; }
        .tire-rear-right { bottom: 20px; right: -10px; }
        .tire-spare { bottom: -25px; left: 50%; transform: translateX(-50%); }

        .tire-input-group {
            display: flex;
            align-items: center;
            margin-bottom: 3px;
            width: 100%;
            justify-content: space-between;
        }
        .tire-input-group:last-child {
            margin-bottom: 0;
        }

        .tire-input-group label {
            font-size: 9px;
            white-space: nowrap;
            margin-right: 5px;
        }

        .pressure-input, .thickness-input {
            background: white;
            border: 1px solid #ccc;
            width: 45px;
            height: 15px;
            text-align: center;
            font-size: 9px;
            padding: 0 2px;
        }
        .tire-position small {
            font-size: 8px;
            margin-left: 2px;
        }

        /* Vị trí mới cho Size lốp khuyến cáo */
        .tire-size-recommendation {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            padding-top: 20px;
            flex-grow: 1;
            width: calc(100% - 200px - 10px);
        }

        .tire-size-recommendation label {
            font-weight: bold;
            margin-bottom: 5px;
            white-space: nowrap;
        }

        .tire-size-recommendation input {
            border: none;
            border-bottom: 1px dotted #000;
            width: 100%;
            text-align: left;
        }

        .recommendation {
            margin-top: 0;
            font-size: 11px;
            width: 100%;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }

        .recommendation label {
            margin-bottom: 5px;
        }

        .recommendation textarea {
            width: 100%;
            flex-grow: 1;
            border: 1px dotted #000;
            padding: 5px;
            resize: vertical;
            font-size: 11px;
            min-height: 50px;
        }

        /* Safety Check Section */
        .safety-check {
            border: 1px solid #000;
            padding: 10px;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .safety-title {
            background: #003366;
            color: white;
            text-align: center;
            font-weight: bold;
            padding: 5px;
            margin: -10px -10px 10px -10px;
        }

        .safety-grid {
            display: grid;
            grid-template-columns: 3fr 1fr 1fr 1fr; /* 3fr cho Hạng mục, 1fr cho Tốt, Lưu ý, Thay */
            gap: 5px;
            font-size: 11px;
            flex-grow: 1;
        }

        .safety-header {
            font-weight: bold;
            text-align: center;
            padding: 3px;
            background: #f0f0f0;
        }
        /* Căn chỉnh lại vị trí tiêu đề TỐT, LƯU Ý, THAY */
        .safety-grid .safety-header:nth-child(2), /* TỐT */
        .safety-grid .safety-header:nth-child(3), /* LƯU Ý */
        .safety-grid .safety-header:nth-child(4) { /* THAY */
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 3px 0;
        }


        .safety-item {
            display: contents; /* Vẫn dùng contents để các div con nằm trực tiếp trong grid */
        }

        .item-name {
            padding: 3px;
            border-bottom: 1px dotted #ccc;
            text-align: left;
        }

        .checkbox-cell {
            text-align: center;
            padding: 3px;
            border-bottom: 1px dotted #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .checkbox {
            width: 15px;
            height: 15px;
            border: 1px solid #000;
            cursor: pointer;
            margin: 0;
        }

        /* Detailed Check Table */
        .detailed-check {
            margin-top: 15px;
            width: 100%;
            border-collapse: collapse;
            border: 2px solid #000;
        }

        .detailed-check th,
        .detailed-check td {
            border: 1px solid #000;
            padding: 5px;
            text-align: center;
            font-size: 11px;
        }

        .detailed-check th {
            background: #003366;
            color: white;
            font-weight: bold;
        }

        .detailed-check .stt {
            width: 30px;
        }

        .detailed-check .hang-muc {
            width: 120px;
            text-align: left;
        }

        .detailed-check .dien-giai {
            width: 180px;
        }

        .detailed-check .sl {
            width: 50px;
        }

        .detailed-check .don-gia,
        .detailed-check .thanh-tien {
            width: 90px;
        }

        .detailed-check .xac-nhan {
            width: 60px;
        }
        
        /* Style cho input và checkbox trong bảng */
        .detailed-check input[type="text"] {
            width: 100%;
            border: none;
            text-align: center;
            padding: 2px 0;
            font-size: 11px;
            background: transparent;
        }

        .detailed-check input[type="text"].hang-muc-input {
            text-align: left;
        }

        .detailed-check input[type="checkbox"] {
            width: 15px;
            height: 15px;
            margin: 0 auto;
            display: block;
        }

        .total-row {
            background: #ccc;
            font-weight: bold;
        }

        /* Signature Section */
        .signature-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 50px;
            margin-top: 20px;
            padding-top: 15px;
        }

        .signature-box {
            text-align: center;
        }

        .signature-title {
            font-weight: bold;
            margin-bottom: 30px;
        }

        .signature-line {
            border-bottom: 1px solid #000;
            margin-bottom: 5px;
            height: 1px;
        }

        .signature-subtitle {
            font-size: 10px;
            font-style: italic;
        }

        /* Footer */
        .footer {
            margin-top: 15px;
            font-size: 9px;
            line-height: 1.2;
            border-top: 1px solid #ccc;
            padding-top: 10px;
        }

        .print-button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 20px;
            font-size: 16px;
        }

        .print-button:hover {
            background: #0056b3;
        }

        /* Print Styles */
        @media print {
            body {
                margin: 0;
                padding: 0;
                background: white;
                font-size: 11px;
                font-weight: 500;
            }

            .container {
                max-width: none;
                box-shadow: none;
                margin: 0;
                padding: 0;
            }

            .form-content {
                padding: 8mm;
                width: 210mm;
                height: 297mm;
                box-sizing: border-box;
                overflow: hidden;
            }

            .print-button {
                display: none;
            }

            .header {
                margin-bottom: 8px;
                padding-bottom: 5px;
            }

            .header h1 {
                font-size: 18px;
            }

            .form-number {
                font-size: 14px;
            }

            .logo {
                width: 60px;
                height: 45px;
                font-size: 8px;
            }

            .customer-info {
                margin-bottom: 8px;
                gap: 10px;
            }

            .info-group {
                margin-bottom: 4px;
                font-size: 10px;
            }
            .info-group .info-input {
                font-size: 10px;
                min-width: 40px; /* Nhỏ hơn khi in */
            }
            .info-group .info-input.name-input {
                min-width: 100px;
            }
            .info-group .info-input.phone-email-input {
                min-width: 60px;
            }
            .info-group .info-input.datetime-input {
                min-width: 90px;
            }
            .info-group .info-input.car-type-input {
                min-width: 100px;
            }
            .info-group .info-input.license-km-input {
                min-width: 60px;
            }
            .info-group.inline-fields {
                justify-content: flex-start; /* Không space-between khi in */
            }
            .info-group.inline-fields > div {
                margin-right: 5px; /* Khoảng cách giữa các nhóm label-input */
            }
            .info-group.inline-fields label {
                margin-right: 2px;
            }


            .main-content {
                gap: 8px;
                margin-bottom: 8px;
            }

            .tire-diagram-container {
                margin-bottom: 5px;
            }

            .tire-diagram {
                width: 150px;
                height: 220px;
                margin-right: 5px;
            }

            .tire-position {
                font-size: 7px;
                padding: 3px;
            }

            .tire-input-group label {
                font-size: 7px;
            }

            .pressure-input, .thickness-input {
                width: 30px;
                height: 10px;
                font-size: 7px;
            }
            .tire-position small {
                font-size: 6px;
            }

            .tire-size-recommendation {
                padding-top: 15px;
                font-size: 9px;
            }
            .tire-size-recommendation label {
                margin-bottom: 2px;
            }
            .tire-size-recommendation input {
                min-width: 80px;
                font-size: 9px;
            }

            .recommendation {
                margin-top: 0;
                font-size: 9px;
                height: 100px;
            }
            .recommendation textarea {
                min-height: 80px;
                height: 80px;
                font-size: 9px;
            }

            .safety-check {
                padding: 5px;
                height: auto; 
                flex-grow: 0;
            }
            .safety-grid {
                flex-grow: 0;
                height: auto;
            }
            .safety-item {
                page-break-inside: avoid;
            }


            .safety-title {
                padding: 3px;
                font-size: 11px;
                margin: -5px -5px 5px -5px;
            }

            .safety-grid {
                font-size: 9px;
                gap: 2px;
            }

            .checkbox {
                width: 12px;
                height: 12px;
            }

            .item-name {
                padding: 1px;
                font-size: 9px;
            }

            .detailed-check {
                margin-top: 8px;
                font-size: 9px;
            }

            .detailed-check th,
            .detailed-check td {
                padding: 2px;
                font-size: 9px;
            }

            .detailed-check input[type="text"] {
                font-size: 9px;
            }

            .detailed-check input[type="checkbox"] {
                width: 12px;
                height: 12px;
            }

            .footer {
                font-size: 8px;
                margin-top: 8px;
                padding-top: 5px;
                line-height: 1.1;
            }

            .signature-section {
                margin-top: 8px;
                padding-top: 5px;
                gap: 30px;
            }

            .signature-title {
                margin-bottom: 15px;
                font-size: 10px;
            }

            .signature-subtitle {
                font-size: 8px;
            }

            /* Đảm bảo tất cả nội dung vừa 1 trang */
            .main-content,
            .detailed-check,
            .signature-section {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <button class="print-button" onclick="handlePrint()">🖨️ In Phiếu Kiểm Tra</button>
        
        <div class="form-content">
            <div class="header">
                <div class="header-left">
                    <h1>PHIẾU KIỂM TRA XE</h1>
                    <div class="form-number">№ <span id="receiptNumber"></span> / <span id="currentMonth"></span></div>
                </div>
                <div class="header-right">
                    <div class="logo">
                        PHILONGAUTO<br>CAR SERVICE
                    </div>
                </div>
            </div>

            <div class="customer-info">
                <div class="customer-left">
                    <div class="info-group">
                        <label for="customerName">Họ tên:</label>
                        <input type="text" id="customerName" class="info-input name-input">
                    </div>
                    <div class="info-group inline-fields">
                        <div>
                            <label for="customerPhone">Điện thoại:</label>
                            <input type="tel" id="customerPhone" class="info-input phone-email-input">
                        </div>
                        <div>
                            <label for="customerEmail">E-mail:</label>
                            <input type="email" id="customerEmail" class="info-input phone-email-input">
                        </div>
                    </div>
                    <div class="info-group">
                        <label for="receivedDateTime">Ngày giờ nhận xe:</label>
                        <input type="datetime-local" id="receivedDateTime" class="info-input datetime-input">
                    </div>
                    <div class="info-group">
                        <label>Kiểm tra an toàn:</label>
                        <label><input type="checkbox"> Có</label>
                        <label><input type="checkbox"> Không</label>
                    </div>
                </div>
                <div class="customer-right">
                    <div class="info-group">
                        <label for="carType">Loại & kiểu xe:</label>
                        <input type="text" id="carType" class="info-input car-type-input">
                    </div>
                    <div class="info-group inline-fields">
                        <div>
                            <label for="licensePlate">Biển số:</label>
                            <input type="text" id="licensePlate" class="info-input license-km-input">
                        </div>
                        <div>
                            <label for="kilometer">Kilô-mét:</label>
                            <input type="text" id="kilometer" class="info-input license-km-input">
                        </div>
                    </div>
                    <div class="info-group">
                        <label for="deliveryDateTime">Ngày gởi giao xe:</label>
                        <input type="datetime-local" id="deliveryDateTime" class="info-input datetime-input">
                    </div>
                </div>
            </div>

            <div class="main-content">
                <div class="tire-section">
                    <div class="tire-diagram-container">
                        <div class="tire-diagram">
                            <div class="tire-position tire-front-left">
                                <div class="tire-input-group">
                                    <label>Áp suất:</label>
                                    <input type="text" class="pressure-input" placeholder="0">
                                    <small>kg/cm²</small>
                                </div>
                                <div class="tire-input-group">
                                    <label>Độ dày:</label>
                                    <input type="text" class="thickness-input" placeholder="0">
                                    <small>mm</small>
                                </div>
                            </div>
                            <div class="tire-position tire-front-right">
                                <div class="tire-input-group">
                                    <label>Áp suất:</label>
                                    <input type="text" class="pressure-input" placeholder="0">
                                    <small>kg/cm²</small>
                                </div>
                                <div class="tire-input-group">
                                    <label>Độ dày:</label>
                                    <input type="text" class="thickness-input" placeholder="0">
                                    <small>mm</small>
                                </div>
                            </div>
                            <div class="tire-position tire-rear-left">
                                <div class="tire-input-group">
                                    <label>Áp suất:</label>
                                    <input type="text" class="pressure-input" placeholder="0">
                                    <small>kg/cm²</small>
                                </div>
                                <div class="tire-input-group">
                                    <label>Độ dày:</label>
                                    <input type="text" class="thickness-input" placeholder="0">
                                    <small>mm</small>
                                </div>
                            </div>
                            <div class="tire-position tire-rear-right">
                                <div class="tire-input-group">
                                    <label>Áp suất:</label>
                                    <input type="text" class="pressure-input" placeholder="0">
                                    <small>kg/cm²</small>
                                </div>
                                <div class="tire-input-group">
                                    <label>Độ dày:</label>
                                    <input type="text" class="thickness-input" placeholder="0">
                                    <small>mm</small>
                                </div>
                            </div>
                            <div class="tire-position tire-spare">
                                <div class="tire-input-group">
                                    <label>Áp suất:</label>
                                    <input type="text" class="pressure-input" placeholder="0">
                                    <small>kg/cm²</small>
                                </div>
                                <div class="tire-input-group">
                                    <label>Độ dày:</label>
                                    <input type="text" class="thickness-input" placeholder="0">
                                    <small>mm</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tire-size-recommendation">
                            <label for="tireSize">Size lốp khuyến cáo:</label>
                            <input type="text" id="tireSize" placeholder="Nhập size lốp">
                        </div>
                    </div>
                    
                    <div class="recommendation">
                        <label for="notes">Lưu ý:</label>
                        <textarea id="notes" placeholder="Ghi chú các lưu ý cần thiết" style="width: 100%; height: auto; flex-grow: 1; border: 1px dotted #000; padding: 5px; resize: vertical; font-size: 11px;"></textarea>
                    </div>
                </div>

                <div class="safety-check">
                    <div class="safety-title">
                        HẠNG MỤC KIỂM TRA AN TOÀN
                    </div>
                    <div class="safety-grid">
                        <div class="safety-header">HẠNG MỤC</div>
                        <div class="safety-header">TỐT</div>
                        <div class="safety-header">LƯU Ý</div>
                        <div class="safety-header">THAY</div>
                        
                        <div class="safety-item">
                            <div class="item-name">Lốp</div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                        </div>
                        
                        <div class="safety-item">
                            <div class="item-name">Gạt mưa</div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                        </div>
                        
                        <div class="safety-item">
                            <div class="item-name">Nước rửa kính</div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                        </div>
                        
                        <div class="safety-item">
                            <div class="item-name">Má phanh</div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                        </div>
                        
                        <div class="safety-item">
                            <div class="item-name">Đĩa phanh</div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                        </div>
                        
                        <div class="safety-item">
                            <div class="item-name">Dầu phanh</div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                        </div>
                        
                        <div class="safety-item">
                            <div class="item-name">Dầu động cơ</div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                        </div>
                        
                        <div class="safety-item">
                            <div class="item-name">Lọc dầu động cơ</div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                        </div>
                        
                        <div class="safety-item">
                            <div class="item-name">Nước làm mát</div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                        </div>
                        
                        <div class="safety-item">
                            <div class="item-name">Ắc quy</div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                        </div>
                        
                        <div class="safety-item">
                            <div class="item-name">Lọc gió động cơ</div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                        </div>
                        
                        <div class="safety-item">
                            <div class="item-name">Lọc gió điều hòa</div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                        </div>
                        
                        <div class="safety-item">
                            <div class="item-name">Thước lái</div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                            <div class="checkbox-cell"><input type="checkbox" class="checkbox"></div>
                        </div>
                    </div>
                </div>
            </div>

            <table class="detailed-check">
                <thead>
                    <tr>
                        <th class="stt">STT</th>
                        <th class="hang-muc">HẠNG MỤC</th>
                        <th class="dien-giai">DIỄN GIẢI</th>
                        <th class="sl">SL</th>
                        <th class="don-gia">ĐƠN GIÁ</th>
                        <th class="thanh-tien">THÀNH TIỀN</th>
                        <th class="xac-nhan">XÁC NHẬN</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>01</td>
                        <td class="hang-muc"><input type="text" class="hang-muc-input" value="Lốp"></td>
                        <td><input type="text" class="dien-giai-input"></td>
                        <td><input type="text" class="sl-input" oninput="calculateRowTotal(this)"></td>
                        <td><input type="text" class="don-gia-input" oninput="calculateRowTotal(this)"></td>
                        <td><input type="text" class="thanh-tien-input" readonly></td>
                        <td class="xac-nhan"><input type="checkbox"></td>
                    </tr>
                    <tr>
                        <td>02</td>
                        <td class="hang-muc"><input type="text" class="hang-muc-input" value="Vận"></td>
                        <td><input type="text" class="dien-giai-input"></td>
                        <td><input type="text" class="sl-input" oninput="calculateRowTotal(this)"></td>
                        <td><input type="text" class="don-gia-input" oninput="calculateRowTotal(this)"></td>
                        <td><input type="text" class="thanh-tien-input" readonly></td>
                        <td class="xac-nhan"><input type="checkbox"></td>
                    </tr>
                    <tr>
                        <td>03</td>
                        <td class="hang-muc"><input type="text" class="hang-muc-input" value="Cân bằng động"></td>
                        <td><input type="text" class="dien-giai-input"></td>
                        <td><input type="text" class="sl-input" oninput="calculateRowTotal(this)"></td>
                        <td><input type="text" class="don-gia-input" oninput="calculateRowTotal(this)"></td>
                        <td><input type="text" class="thanh-tien-input" readonly></td>
                        <td class="xac-nhan"><input type="checkbox"></td>
                    </tr>
                    <tr>
                        <td>04</td>
                        <td class="hang-muc"><input type="text" class="hang-muc-input" value="Cân chỉnh thước lái"></td>
                        <td><input type="text" class="dien-giai-input"></td>
                        <td><input type="text" class="sl-input" oninput="calculateRowTotal(this)"></td>
                        <td><input type="text" class="don-gia-input" oninput="calculateRowTotal(this)"></td>
                        <td><input type="text" class="thanh-tien-input" readonly></td>
                        <td class="xac-nhan"><input type="checkbox"></td>
                    </tr>
                    <tr>
                        <td>05</td>
                        <td class="hang-muc"><input type="text" class="hang-muc-input" value="Phanh"></td>
                        <td><input type="text" class="dien-giai-input"></td>
                        <td><input type="text" class="sl-input" oninput="calculateRowTotal(this)"></td>
                        <td><input type="text" class="don-gia-input" oninput="calculateRowTotal(this)"></td>
                        <td><input type="text" class="thanh-tien-input" readonly></td>
                        <td class="xac-nhan"><input type="checkbox"></td>
                    </tr>
                    <tr>
                        <td>06</td>
                        <td class="hang-muc"><input type="text" class="hang-muc-input" value="Gạt mưa"></td>
                        <td><input type="text" class="dien-giai-input"></td>
                        <td><input type="text" class="sl-input" oninput="calculateRowTotal(this)"></td>
                        <td><input type="text" class="don-gia-input" oninput="calculateRowTotal(this)"></td>
                        <td><input type="text" class="thanh-tien-input" readonly></td>
                        <td class="xac-nhan"><input type="checkbox"></td>
                    </tr>
                    <tr>
                        <td>07</td>
                        <td class="hang-muc"><input type="text" class="hang-muc-input" value="Nước rửa kính"></td>
                        <td><input type="text" class="dien-giai-input"></td>
                        <td><input type="text" class="sl-input" oninput="calculateRowTotal(this)"></td>
                        <td><input type="text" class="don-gia-input" oninput="calculateRowTotal(this)"></td>
                        <td><input type="text" class="thanh-tien-input" readonly></td>
                        <td class="xac-nhan"><input type="checkbox"></td>
                    </tr>
                    <tr>
                        <td>08</td>
                        <td class="hang-muc"><input type="text" class="hang-muc-input" value="Dầu động cơ"></td>
                        <td><input type="text" class="dien-giai-input"></td>
                        <td><input type="text" class="sl-input" oninput="calculateRowTotal(this)"></td>
                        <td><input type="text" class="don-gia-input" oninput="calculateRowTotal(this)"></td>
                        <td><input type="text" class="thanh-tien-input" readonly></td>
                        <td class="xac-nhan"><input type="checkbox"></td>
                    </tr>
                    <tr>
                        <td>09</td>
                        <td class="hang-muc"><input type="text" class="hang-muc-input" value="Lọc dầu động cơ"></td>
                        <td><input type="text" class="dien-giai-input"></td>
                        <td><input type="text" class="sl-input" oninput="calculateRowTotal(this)"></td>
                        <td><input type="text" class="don-gia-input" oninput="calculateRowTotal(this)"></td>
                        <td><input type="text" class="thanh-tien-input" readonly></td>
                        <td class="xac-nhan"><input type="checkbox"></td>
                    </tr>
                    <tr>
                        <td>10</td>
                        <td class="hang-muc"><input type="text" class="hang-muc-input" value="Lọc gió động cơ"></td>
                        <td><input type="text" class="dien-giai-input"></td>
                        <td><input type="text" class="sl-input" oninput="calculateRowTotal(this)"></td>
                        <td><input type="text" class="don-gia-input" oninput="calculateRowTotal(this)"></td>
                        <td><input type="text" class="thanh-tien-input" readonly></td>
                        <td class="xac-nhan"><input type="checkbox"></td>
                    </tr>
                    <tr>
                        <td>11</td>
                        <td class="hang-muc"><input type="text" class="hang-muc-input" value="Lọc gió điều hòa"></td>
                        <td><input type="text" class="dien-giai-input"></td>
                        <td><input type="text" class="sl-input" oninput="calculateRowTotal(this)"></td>
                        <td><input type="text" class="don-gia-input" oninput="calculateRowTotal(this)"></td>
                        <td><input type="text" class="thanh-tien-input" readonly></td>
                        <td class="xac-nhan"><input type="checkbox"></td>
                    </tr>
                    <tr>
                        <td>12</td>
                        <td class="hang-muc"><input type="text" class="hang-muc-input"></td>
                        <td><input type="text" class="dien-giai-input"></td>
                        <td><input type="text" class="sl-input" oninput="calculateRowTotal(this)"></td>
                        <td><input type="text" class="don-gia-input" oninput="calculateRowTotal(this)"></td>
                        <td><input type="text" class="thanh-tien-input" readonly></td>
                        <td class="xac-nhan"><input type="checkbox"></td>
                    </tr>
                    <tr>
                        <td>13</td>
                        <td class="hang-muc"><input type="text" class="hang-muc-input"></td>
                        <td><input type="text" class="dien-giai-input"></td>
                        <td><input type="text" class="sl-input" oninput="calculateRowTotal(this)"></td>
                        <td><input type="text" class="don-gia-input" oninput="calculateRowTotal(this)"></td>
                        <td><input type="text" class="thanh-tien-input" readonly></td>
                        <td class="xac-nhan"><input type="checkbox"></td>
                    </tr>
                    <tr>
                        <td>14</td>
                        <td class="hang-muc"><input type="text" class="hang-muc-input"></td>
                        <td><input type="text" class="dien-giai-input"></td>
                        <td><input type="text" class="sl-input" oninput="calculateRowTotal(this)"></td>
                        <td><input type="text" class="don-gia-input" oninput="calculateRowTotal(this)"></td>
                        <td><input type="text" class="thanh-tien-input" readonly></td>
                        <td class="xac-nhan"><input type="checkbox"></td>
                    </tr>
                    <tr>
                        <td>15</td>
                        <td class="hang-muc"><input type="text" class="hang-muc-input"></td>
                        <td><input type="text" class="dien-giai-input"></td>
                        <td><input type="text" class="sl-input" oninput="calculateRowTotal(this)"></td>
                        <td><input type="text" class="don-gia-input" oninput="calculateRowTotal(this)"></td>
                        <td><input type="text" class="thanh-tien-input" readonly></td>
                        <td class="xac-nhan"><input type="checkbox"></td>
                    </tr>
                    <tr class="total-row">
                        <td colspan="5">TỔNG CỘNG</td>
                        <td><input type="text" id="grand-total" readonly style="font-weight: bold;"></td>
                        <td></td> 
                    </tr>
                </tbody>
            </table>

            <div class="footer">
                <p><strong>Khuyến nghị:</strong></p>
                <p>□ "Tôi đồng ý đăng ký số liệu cá nhân năm được cung cấp theo mẫu này có thể được lưu trữ và sử dụng cho mục đích liên quan đến 02 năm PHI LONG AUTO (Công Ty), nhằm mục đích truyền thông sản phẩm và dịch vụ của chúng tôi và các đối tác kinh doanh liên quan. Tôi có thể rút lại sự đồng ý của mình bất cứ lúc nào bằng cách liên hệ với Công Ty và yêu cầu loại bỏ thông tin cá nhân của tôi khỏi cơ sở dữ liệu này."</p>
            </div>

            <div class="signature-section">
                <div class="signature-box">
                    <div class="signature-title">Đại lý</div>
                    <div class="signature-line"></div>
                    <div class="signature-subtitle">(Ký tên)</div>
                </div>
                <div class="signature-box">
                    <div class="signature-title">Khách hàng</div>
                    <div class="signature-line"></div>
                    <div class="signature-subtitle">(Ký tên)</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Các hàm tính toán tổng và ngày giờ vẫn được giữ nguyên
        function calculateRowTotal(inputElement) {
            const row = inputElement.closest('tr');
            const quantity = parseFloat(row.querySelector('.sl-input').value) || 0;
            const unitPrice = parseFloat(row.querySelector('.don-gia-input').value) || 0;
            const total = quantity * unitPrice;
            row.querySelector('.thanh-tien-input').value = total.toLocaleString('vi-VN');

            updateGrandTotal();
        }

        function updateGrandTotal() {
            let grandTotal = 0;
            document.querySelectorAll('.thanh-tien-input').forEach(input => {
                const value = parseFloat(input.value.replace(/\./g, '').replace(/,/g, '.')) || 0;
                grandTotal += value;
            });
            document.getElementById('grand-total').value = grandTotal.toLocaleString('vi-VN');
        }

        function getCurrentDateTimeLocal() {
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            return now.toISOString().slice(0, 16);
        }

        // --- Logic quản lý số phiếu ---
        const RECEIPT_NUMBER_KEY = 'phieuKiemTraXe_receiptNumber';
        const LAST_MONTH_KEY = 'phieuKiemTraXe_lastMonth';

        function initializeReceiptNumber() {
            const now = new Date();
            const currentMonth = now.getMonth(); // 0-11
            const currentYear = now.getFullYear();
            const storedMonthData = localStorage.getItem(LAST_MONTH_KEY);
            let receiptNumber = parseInt(localStorage.getItem(RECEIPT_NUMBER_KEY)) || 0;
            let lastStoredMonth = null;

            if (storedMonthData) {
                try {
                    const parsedMonthData = JSON.parse(storedMonthData);
                    lastStoredMonth = parsedMonthData.month;
                    const lastStoredYear = parsedMonthData.year;

                    if (currentMonth !== lastStoredMonth || currentYear !== lastStoredYear) {
                        // Tháng hoặc năm đã thay đổi, đặt lại số thứ tự
                        receiptNumber = 1;
                        localStorage.setItem(RECEIPT_NUMBER_KEY, receiptNumber);
                        localStorage.setItem(LAST_MONTH_KEY, JSON.stringify({ month: currentMonth, year: currentYear }));
                    } else {
                        // Vẫn trong cùng tháng/năm, tăng số thứ tự lên 1 cho lần tải đầu tiên
                        // (hoặc giữ nguyên nếu đây là lần tải sau khi in và số đã được tăng)
                        // Logic này sẽ được điều chỉnh để chỉ tăng khi nhấn nút in.
                        // Tại đây, chỉ lấy số hiện có.
                    }
                } catch (e) {
                    console.error("Lỗi khi đọc dữ liệu tháng từ localStorage:", e);
                    // Reset nếu dữ liệu bị lỗi
                    receiptNumber = 1;
                    localStorage.setItem(RECEIPT_NUMBER_KEY, receiptNumber);
                    localStorage.setItem(LAST_MONTH_KEY, JSON.stringify({ month: currentMonth, year: currentYear }));
                }
            } else {
                // Lần đầu tiên, đặt số thứ tự là 1 và lưu tháng hiện tại
                receiptNumber = 1;
                localStorage.setItem(RECEIPT_NUMBER_KEY, receiptNumber);
                localStorage.setItem(LAST_MONTH_KEY, JSON.stringify({ month: currentMonth, year: currentYear }));
            }
            
            // Hiển thị số phiếu và tháng
            document.getElementById('receiptNumber').textContent = String(receiptNumber).padStart(6, '0');
            document.getElementById('currentMonth').textContent = `${String(currentMonth + 1).padStart(2, '0')}/${currentYear}`;
        }

        function incrementReceiptNumberOnPrint() {
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            let receiptNumber = parseInt(localStorage.getItem(RECEIPT_NUMBER_KEY)) || 0;
            const storedMonthData = localStorage.getItem(LAST_MONTH_KEY);
            let lastStoredMonth = null;
            let lastStoredYear = null;

            if (storedMonthData) {
                try {
                    const parsedMonthData = JSON.parse(storedMonthData);
                    lastStoredMonth = parsedMonthData.month;
                    lastStoredYear = parsedMonthData.year;
                } catch (e) {
                    console.error("Lỗi khi đọc dữ liệu tháng từ localStorage:", e);
                    // Xử lý lỗi, có thể reset nếu cần
                }
            }

            if (currentMonth !== lastStoredMonth || currentYear !== lastStoredYear) {
                // Tháng hoặc năm đã thay đổi, reset số thứ tự
                receiptNumber = 1;
            } else {
                // Vẫn trong cùng tháng/năm, tăng số thứ tự
                receiptNumber++;
            }

            // Cập nhật localStorage
            localStorage.setItem(RECEIPT_NUMBER_KEY, receiptNumber);
            localStorage.setItem(LAST_MONTH_KEY, JSON.stringify({ month: currentMonth, year: currentYear }));
            
            // Cập nhật hiển thị trên phiếu trước khi in
            document.getElementById('receiptNumber').textContent = String(receiptNumber).padStart(6, '0');
            document.getElementById('currentMonth').textContent = `${String(currentMonth + 1).padStart(2, '0')}/${currentYear}`;
        }

        function handlePrint() {
            // Tăng số phiếu trước khi in
            incrementReceiptNumberOnPrint();
            window.print();
        }

        // Gọi các hàm khi trang tải
        document.addEventListener('DOMContentLoaded', () => {
            initializeReceiptNumber(); // Khởi tạo số phiếu và tháng khi tải trang
            
            const receivedDateTimeInput = document.getElementById('receivedDateTime');
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            receivedDateTimeInput.value = `${year}-${month}-${day}T${hours}:${minutes}`;
        });
    </script>
</body>
</html>
