<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Phi·∫øu Ki·ªÉm Tra G·∫ßm</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ------------------------------------- */
        /* Ghi ch√∫: Ph·∫ßn Styling chung cho m√†n h√¨nh hi·ªÉn th·ªã */
        /* ------------------------------------- */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f3f4f6; /* M√†u n·ªÅn x√°m nh·∫°t */
            padding: 1rem; /* Gi·∫£m padding t·ªïng th·ªÉ */
            color: #212529; /* M√†u ch·ªØ ch√≠nh */
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        /* M√†u n·ªÅn cho ti√™u ƒë·ªÅ b·∫£ng */
        .table-header-bg {
            background-color: #fde68a; /* V√†ng */
        }
        /* M√†u n·ªÅn v√† ch·ªØ cho c·ªôt 'Thay' */
        .checkbox-header-thay {
            background-color: #ea580c; /* Cam */
            color: white;
        }
        /* M√†u n·ªÅn v√† ch·ªØ cho c·ªôt 'L∆∞u √ù' */
        .checkbox-header-luuy {
            background-color: #e0e7ff; /* Xanh nh·∫°t */
            color: #1e3a8a;
        }
        /* M√†u n·ªÅn v√† ch·ªØ cho c·ªôt 'T·ªët' */
        .checkbox-header-tot {
            background-color: #22c55e; /* Xanh l√° */
            color: white;
        }
        /* Ki·ªÉu d√°ng cho ti√™u ƒë·ªÅ c√°c ph·∫ßn form */
        .form-section-title {
            font-weight: 700; /* In ƒë·∫≠m */
            border-bottom: 1px solid #334155; /* Gi·∫£m ƒë·ªô d√†y vi·ªÅn */
            padding-bottom: 0.1rem; /* Gi·∫£m padding d∆∞·ªõi */
            margin-bottom: 0.4rem; /* Gi·∫£m kho·∫£ng c√°ch d∆∞·ªõi */
            font-size: 1.1rem; /* Gi·∫£m c·ª° ch·ªØ */
            color: #1e293b; /* M√†u ch·ªØ */
        }
        /* Ki·ªÉu d√°ng chung cho ti√™u ƒë·ªÅ v√† √¥ d·ªØ li·ªáu b·∫£ng */
        th, td {
            vertical-align: top; /* CƒÉn tr√™n c√πng ƒë·ªÉ n·ªôi dung textarea kh√¥ng b·ªã l·ªách */
            padding: 0.2rem 0.4rem; /* Gi·∫£m kho·∫£ng ƒë·ªám */
            border-bottom: 1px solid #94a3b8; /* ƒê∆∞·ªùng vi·ªÅn d∆∞·ªõi */
        }
        /* Ki·ªÉu d√°ng cho nh√£n c·ªßa checkbox */
        label.checkbox-label {
            cursor: pointer; /* Bi·ªÉu t∆∞·ª£ng con tr·ªè khi di chu·ªôt */
            user-select: none; /* Kh√¥ng cho ph√©p ch·ªçn vƒÉn b·∫£n */
        }
        /* Ki·ªÉu d√°ng cho √¥ nh·∫≠p vƒÉn b·∫£n nhi·ªÅu d√≤ng (textarea) */
        textarea {
            resize: vertical; /* Ch·ªâ cho ph√©p thay ƒë·ªïi k√≠ch th∆∞·ªõc theo chi·ªÅu d·ªçc */
            padding: 0.15rem 0.3rem; /* Gi·∫£m padding */
            border: 1px solid #cbd5e1;
            border-radius: 0.25rem;
            font-family: inherit;
            width: 100%;
            min-height: 28px; /* Gi·∫£m min-height */
            overflow-y: hidden; /* ·∫®n thanh cu·ªôn d·ªçc m·∫∑c ƒë·ªãnh tr√™n m√†n h√¨nh, s·∫Ω t·ª± ƒë·ªông resize */
            box-sizing: border-box; /* ƒê·∫£m b·∫£o padding kh√¥ng l√†m tr√†n width */
            white-space: pre-wrap; /* Quan tr·ªçng: Cho ph√©p xu·ªëng d√≤ng t·ª± ƒë·ªông v√† gi·ªØ kho·∫£ng tr·∫Øng */
            word-wrap: break-word; /* Ng·∫Øt t·ª´ d√†i ƒë·ªÉ tr√°nh tr√†n */
        }
        /* Ki·ªÉu d√°ng cho c√°c √¥ nh·∫≠p li·ªáu d·∫°ng text, date, time, number */
        input[type="text"], input[type="date"], input[type="time"], input[type="number"] {
            border: 1px solid #cbd5e1;
            border-radius: 0.25rem;
            padding: 0.15rem 0.3rem; /* Gi·∫£m padding */
            font-family: inherit;
            box-sizing: border-box;
            min-height: 24px; /* Gi·∫£m min-height */
            width: 100%;
        }
        /* K√≠ch th∆∞·ªõc container cho logo */
        .logo-container {
            width: 70px; /* Gi·∫£m k√≠ch th∆∞·ªõc logo */
            height: 70px;
        }
        .logo-container img {
            width: 70px; height: 70px;
        }
        /* ƒêi·ªÅu ch·ªânh c√°c c·∫∑p label-input trong ph·∫ßn th√¥ng tin */
        .info-field-group {
            display: flex; align-items: center;
            gap: 0.2rem; /* Kho·∫£ng c√°ch nh·ªè gi·ªØa label v√† input */
        }
        .info-field-group label {
            flex-shrink: 0; /* NgƒÉn label b·ªã co l·∫°i */
            white-space: nowrap; /* NgƒÉn label xu·ªëng d√≤ng */
            font-weight: bold;
            min-width: 40px; /* ƒê·∫£m b·∫£o label c√≥ ƒë·ªô r·ªông t·ªëi thi·ªÉu */
        }
        .info-field-group input,
        .info-field-group textarea,
        .info-field-group select { /* Th√™m select v√†o ƒë√¢y */
            flex-grow: 1; /* Cho ph√©p input/textarea/select m·ªü r·ªông */
            min-width: 0; /* Cho ph√©p input/textarea/select co l·∫°i */
        }


        /* === ƒêI·ªÄU CH·ªàNH: Style cho textarea trong b·∫£ng (hi·ªán tr·∫°ng ki·ªÉm tra) === */
        .table-textarea {
            resize: none; /* Kh√¥ng cho ph√©p resize b·∫±ng tay */
            overflow-y: hidden; /* ·∫®n thanh cu·ªôn m·∫∑c ƒë·ªãnh tr√™n m√†n h√¨nh */
            min-height: 22px; /* Chi·ªÅu cao t·ªëi thi·ªÉu cho 1 d√≤ng text */
            line-height: 1.2; /* T·ªëi ∆∞u line-height cho n·ªôi dung */
            padding: 0.1rem 0.2rem; /* Padding nh·ªè h∆°n */
            border: 1px solid #cbd5e1; /* Added for consistency with other inputs */
            border-radius: 0.25rem; /* Added for consistency with other inputs */
            box-sizing: border-box;
            white-space: pre-wrap; /* Quan tr·ªçng: Gi·ªØ xu·ªëng d√≤ng v√† kho·∫£ng tr·∫Øng */
            word-wrap: break-word; /* Ng·∫Øt t·ª´ d√†i ƒë·ªÉ tr√°nh tr√†n */
            /* ƒê·∫∑t m·ªôt width c·ª• th·ªÉ ho·∫∑c max-width ƒë·ªÉ ƒëi·ªÅu khi·ªÉn chi·ªÅu r·ªông tr√™n m√†n h√¨nh */
            width: 95%; /* ƒêI·ªÄU CH·ªàNH: Chi·ªÅu r·ªông tr√™n m√†n h√¨nh ƒë·ªÉ n√≥ kh√¥ng chi·∫øm 100% c·ªßa TD */
        }

        /* === ƒêI·ªÄU CH·ªàNH: Style cho textarea "Y√™u c·∫ßu ban ƒë·∫ßu c·ªßa kh√°ch h√†ng" tr√™n m√†n h√¨nh === */
        textarea[name="customerRequest"] {
            width: 100%; /* ƒê·∫£m b·∫£o chi·∫øm h·∫øt chi·ªÅu r·ªông c·ªßa div cha */
            min-height: 50px; /* TƒÉng chi·ªÅu cao t·ªëi thi·ªÉu ƒë·ªÉ d·ªÖ nh·∫≠p li·ªáu */
            resize: vertical; /* Cho ph√©p resize d·ªçc */
            box-sizing: border-box;
            white-space: pre-wrap;
            word-wrap: break-word;
        }


        /* ------------------------------------- */
        /* Ghi ch√∫: Ph·∫ßn Styling khi in ·∫•n (@media print) */
        /* ------------------------------------- */
        @media print {
            body {
                background: white;
                padding: 0 !important;
                margin: 0 !important;
                font-size: 7.5pt; /* Gi·∫£m c·ª° ch·ªØ xu·ªëng 7.5pt ƒë·ªÉ thu g·ªçn t·ªëi ƒëa */
                line-height: 1.1 !important; /* Gi·∫£m kho·∫£ng c√°ch d√≤ng h∆°n n·ªØa */
            }
            .no-print {
                display: none !important;
            }
            table {
                page-break-inside: avoid;
                width: 100% !important;
                margin: 0 !important;
            }
            /* === ƒêI·ªÄU CH·ªàNH CHUNG CHO INPUT/TEXTAREA KHI IN === */
            textarea, input, select { /* Th√™m select v√†o ƒë√¢y */
                border: 1px solid black !important;
                box-shadow: none !important;
                padding: 0.03rem 0.08rem !important; /* Thu g·ªçn padding t·ªëi ƒëa khi in */
                min-height: unset !important; /* Quan tr·ªçng: B·ªè min-height c·ª©ng nh·∫Øc */
                height: auto !important; /* Quan tr·ªçng: Cho ph√©p chi·ªÅu cao t·ª± ƒë·ªông co d√£n theo n·ªôi dung */
                overflow: visible !important; /* Quan tr·ªçng: HI·ªÇN TH·ªä n·ªôi dung tr√†n (kh√¥ng c·∫Øt, kh√¥ng scroll) */
                width: auto !important;
                flex-grow: 1 !important;
                flex-shrink: 1 !important;
                box-sizing: border-box !important;
                white-space: pre-wrap !important; /* ƒê·∫£m b·∫£o xu·ªëng d√≤ng khi in */
                word-wrap: break-word !important; /* Ng·∫Øt t·ª´ d√†i khi in */
            }
            /* === ƒêI·ªÄU CH·ªàNH CHO "Y√äU C·∫¶U BAN ƒê·∫¶U C·ª¶A KH√ÅCH H√ÄNG" KHI IN === */
            textarea[name="customerRequest"] {
                min-height: 40px !important; /* Chi·ªÅu cao t·ªëi thi·ªÉu khi in, nh∆∞ng s·∫Ω t·ª± ƒë·ªông tƒÉng */
                padding: 0.1rem 0.2rem !important; /* Gi·ªØ padding h·ª£p l√Ω */
                width: 100% !important; /* ƒê·∫£m b·∫£o chi·∫øm 100% chi·ªÅu r·ªông c·ªßa div ch·ª©a n√≥ */
                max-width: 100% !important;
            }
            /* === ƒêI·ªÄU CH·ªàNH CHO TEXTAREA TRONG B·∫¢NG KHI IN (QUAN TR·ªåNG NH·∫§T) === */
            .table-textarea {
                min-height: 16px !important; /* ƒêI·ªÄU CH·ªàNH: Chi·ªÅu cao t·ªëi thi·ªÉu cho 1 d√≤ng khi in (gi·∫£m t·ª´ 18px) */
                height: auto !important; /* ƒê·∫£m b·∫£o t·ª± ƒë·ªông co gi√£n theo n·ªôi dung */
                overflow: visible !important; /* Hi·ªÉn th·ªã to√†n b·ªô n·ªôi dung, kh√¥ng c·∫Øt */
                line-height: 1 !important; /* ƒêI·ªÄU CH·ªàNH: Gi·∫£m line-height khi in (t·ª´ 1.1) */
                padding: 0.02rem 0.05rem !important; /* ƒêI·ªÄU CH·ªàNH: Padding r·∫•t nh·ªè (gi·∫£m t·ª´ 0.05rem 0.1rem) */
                /* === ƒêI·ªÄU CH·ªàNH CHI·ªÄU R·ªòNG C·ª¶A TEXTAREA B√äN TRONG C·ªòT KHI IN === */
                width: 100% !important; /* B·∫ÆT BU·ªòC TEXTAREA CHI·∫æM 100% CHI·ªÄU R·ªòNG C·ª¶A √î TD */
                max-width: 100% !important; /* ƒê·∫£m b·∫£o kh√¥ng b·ªã gi·ªõi h·∫°n */
            }
            
            section.grid {
                gap-x: 0.3rem !important; /* Gi·∫£m kho·∫£ng c√°ch gi·ªØa c√°c c·ªôt t·ªëi ƒëa */
                gap-y: 0.05rem !important; /* Gi·∫£m kho·∫£ng c√°ch gi·ªØa c√°c h√†ng t·ªëi ƒëa */
                margin-bottom: 0.3rem !important; /* ƒêI·ªÄU CH·ªàNH: Gi·∫£m margin-bottom c·ªßa section (t·ª´ 0.4rem) */
            }
            .info-field-group label {
                min-width: 35px !important; /* Thu g·ªçn min-width c·ªßa label khi in */
                margin-right: 0.1rem !important; /* Gi·∫£m kho·∫£ng c√°ch */
            }
            header {
                margin-bottom: 0.2rem !important;
                padding-bottom: 0.2rem !important;
            }
            h1 {
                font-size: 1.0rem !important; /* Gi·∫£m c·ª° ch·ªØ ti√™u ƒë·ªÅ ch√≠nh h∆°n n·ªØa */
            }
            .form-section-title {
                font-size: 0.75rem !important; /* Gi·∫£m c·ª° ch·ªØ ti√™u ƒë·ªÅ section h∆°n n·ªØa */
                margin-bottom: 0.05rem !important;
                padding-bottom: 0.03rem !important;
                border-bottom-width: 1px !important;
            }
            .max-w-6xl {
                max-width: 100% !important;
                box-shadow: none !important;
                border: none !important;
                padding: 0 !important; /* ƒêI·ªÄU CH·ªàNH: ƒê·∫£m b·∫£o padding c·ªßa form l√† 0 */
                margin: 0 !important;
            }
            .p-1, .p-2, .p-3, .p-4, .px-3, .py-1, .pl-3 {
                padding: 0.03rem !important; /* Gi·∫£m padding chung cho c√°c √¥ b·∫£ng t·ªëi ƒëa */
            }
            .mb-6 {
                margin-bottom: 0.2rem !important;
            }
            .mt-6 {
                margin-top: 0.2rem !important;
            }
            .rounded, .rounded-lg {
                border-radius: 0 !important;
            }

            table th, table td {
                padding: 0.03rem 0.08rem !important; /* Padding si√™u nh·ªè cho √¥ b·∫£ng */
                border: 1px solid black !important;
                vertical-align: top !important; /* Quan tr·ªçng: CƒÉn tr√™n c√πng khi in */
            }
            table th:nth-child(1),
            table td:nth-child(1) {
                width: 120px !important; /* Thu g·ªçn chi·ªÅu r·ªông c·ªôt ƒë·∫ßu ti√™n */
                min-width: 120px !important;
            }
            /* === ƒêI·ªÄU CH·ªàNH CH√çNH CHO CHI·ªÄU R·ªòNG C·ªòT TH·ª® 2 (HI·ªÜN TR·∫†NG KI·ªÇM TRA) === */
            table th:nth-child(2),
            table td:nth-child(2) {
                width: 400px !important; /* CHI·ªÄU R·ªòNG T·ªîNG TH·ªÇ C·ª¶A C·ªòT KHI IN (nh∆∞ khung b·∫°n ƒë√£ v·∫Ω) */
                min-width: 400px !important; /* Gi√° tr·ªã n√†y s·∫Ω ƒë·ªãnh nghƒ©a "gi·ªõi h·∫°n table" m√† b·∫°n ƒë√£ khoanh ƒë·ªè. */
                /* B·∫°n c√≥ th·ªÉ tƒÉng ho·∫∑c gi·∫£m n√≥ t√πy theo √Ω mu·ªën ch√≠nh x√°c. */
            }
            /* === ƒêI·ªÄU CH·ªàNH C√ÅC C·ªòT CHECKBOX ƒê·ªÇ NH∆Ø·ªúNG KH√îNG GIAN (ƒê·∫©y s√°t v√†o) === */
            table th:nth-child(3),
            table td:nth-child(3),
            table th:nth-child(4),
            table td:nth-child(4),
            table th:nth-child(5),
            table td:nth-child(5) {
                width: 20px !important; /* GI·∫¢M CHI·ªÄU R·ªòNG T·ªêI ƒêA CHO C√ÅC CHECKBOX */
                min-width: 20px !important;
                max-width: 20px !important;
            }
            .text-sm {
                font-size: 0.7rem !important; /* Gi·∫£m c·ª° ch·ªØ chung cho c√°c ph·∫ßn nh·ªè h∆°n n·ªØa */
            }
            .text-slate-700, .text-slate-800, .text-slate-900 {
                color: black !important;
            }
            strong {
                font-weight: bold !important;
            }
            p {
                margin: 0.05rem 0 !important; /* Gi·∫£m margin cho c√°c ƒëo·∫°n vƒÉn */
            }
            /* === ƒêI·ªÄU CH·ªàNH: Ph·∫ßn ch√∫ th√≠ch khi in === */
            section.note-section { /* ƒê·ªïi t√™n class ƒë·ªÉ d·ªÖ qu·∫£n l√Ω */
                padding: 0.1rem 0.2rem !important; /* ƒêI·ªÄU CH·ªàNH: Gi·∫£m padding ph·∫ßn ch√∫ th√≠ch t·ªëi ƒëa */
                min-height: unset !important; /* B·ªè min-height ƒë·ªÉ n√≥ t·ª± co l·∫°i */
                height: 50px !important; /* Quan tr·ªçng: Cho ph√©p chi·ªÅu cao t·ª± ƒë·ªông */
                margin-top: 0.1rem !important; /* ƒêI·ªÄU CH·ªàNH: Gi·∫£m margin-top t·ªëi ƒëa */
                font-size: 0.65rem !important; /* ƒêI·ªÄU CH·ªàNH: Gi·∫£m c·ª° ch·ªØ trong ch√∫ th√≠ch (t·ª´ 0.65rem xu·ªëng 0.6rem) */
                line-height: 1 !important; /* ƒêI·ªÄU CH·ªàNH: Gi·∫£m line-height trong ch√∫ th√≠ch (t·ª´ 1.05) */
                border: 1px solid #ffc107 !important; /* Gi·ªØ vi·ªÅn */
                background-color: #fff3cd !important; /* Gi·ªØ m√†u n·ªÅn */
            }
            section.note-section p {
                margin: 0 !important; /* B·ªè margin c·ªßa c√°c ƒëo·∫°n vƒÉn trong ch√∫ th√≠ch */
            }


            /* Logo header khi in */
            header .logo-container {
                width: 50px !important; /* Thu nh·ªè logo khi in */
                height: 50px !important;
            }
            header .logo-container img {
                width: 50px !important; height: 50px !important;
            }
            header h1 {
                font-size: 1.0rem !important;
            }
            header div[style="width: 80px;"] { /* This div seems to be a spacer, adjust width in print */
                width: 50px !important;
            }
            .mb-2 { /* ƒêi·ªÅu ch·ªânh cho section "Kho·∫£ng c√°ch m·ªói l·∫ßn b·∫£o d∆∞·ª°ng" */
                margin-bottom: 0.15rem !important; /* Gi·∫£m margin-bottom h∆°n n·ªØa */
            }
            .mb-3 { /* ƒêi·ªÅu ch·ªânh cho section "Y√™u c·∫ßu ban ƒë·∫ßu c·ªßa kh√°ch h√†ng" v√† info grid */
                margin-bottom: 0.25rem !important; /* Gi·∫£m margin-bottom h∆°n n·ªØa */
            }
        }
    </style>
</head>
<body>
    
    <div class="no-print bg-gray-800 text-white p-3 mb-6 flex justify-center space-x-4 rounded-lg shadow-md">
        <a href="#" id="printButton" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition duration-300 ease-in-out">
            In Phi·∫øu
        </a>
        <a href="#" id="submitGamFormBtn" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded transition duration-300 ease-in-out">
            G·ª≠i Th√¥ng Tin
        </a>
        <a href="#" onclick="window.location.href='https://longvt89.github.io/phieukiemtra'"; return false;" class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded transition duration-300 ease-in-out">
            Phi·∫øu Ki·ªÉm Tra An To√†n
        </a>
        <a href="#" onclick="window.location.href='https://longvt89.github.io/phieukiemtra/Phieukiemlop2.html'"; return false;" class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded transition duration-300 ease-in-out">
            Phi·∫øu Ki·ªÉm Tra L·ªëp
        <a href="#" onclick="window.location.href='https://longvt89.github.io/phieukiemtra/phieunhandichvu.html'"; return false;" class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded transition duration-300 ease-in-out">
            Phi·∫øu Ki·ªÉm Tra Xe
        <a href="#" onclick="window.location.href='https://longvt89.github.io/phieukiemtra/tracuu.html'"; return false;" class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded transition duration-300 ease-in-out">
            Tra c·ª©u th√¥ng tin xe
        </a>
        <a href="#" onclick="window.location.href='https://longvt89.github.io/phieukiemtra/baoduong.html'"; return false;" class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded transition duration-300 ease-in-out">
            Phi·∫øu B·∫£o D∆∞·ª°ng
        </a>
    </div>

    
    <form id="inspectionForm" action="https://script.google.com/macros/s/AKfycbzE44UQR_Mu1M9vAxnY6SmrHq-2hTPIr1I-0rpTztwPoN-PoEL0psVLvXb8HY746mRz/exec" method="POST" class="max-w-6xl mx-auto bg-white p-4 shadow-lg rounded-lg" autocomplete="off">
    <input type="hidden" name="formType" value="PhieuKiemTraGam">
    
    <header class="mb-4 border-b border-slate-300 pb-3 flex flex-wrap items-center justify-between">
        <div class="logo-container mr-3 flex-shrink-0">
            <img src="https://longvt89.github.io/phieukiemtra/logophilong.jpg"
                 alt="Logo c√¥ng ty Phi Long Automobile m√†u xanh v√† tr·∫Øng, thi·∫øt k·∫ø d·∫°ng bi·ªÉu t∆∞·ª£ng h√¨nh kh·ªëi hi·ªán ƒë·∫°i"
                 onerror="this.style.display='none'"
                 style="background-color:#e0f2fe; border-radius: 10px; object-fit: contain;" />
        </div>
        <h1 class="text-2xl font-extrabold text-slate-900 flex-grow text-center min-w-[250px]">
            PHI·∫æU KI·ªÇM TRA G·∫¶M
        </h1>
        
        <div style="width: 70px;"></div>
    </header>

    
    <section class="grid grid-cols-6 gap-x-2 gap-y-1 mb-3 text-sm text-slate-800">
        
        <div class="col-span-3 info-field-group">
            <label for="receiveDate">Ng√†y nh·∫≠n xe:</label>
            <input type="date" id="receiveDate" name="receiveDate" required />
        </div>
        <div class="col-span-3 info-field-group">
            <label for="advisor">C·ªë v·∫•n DV:</label>
            <input type="text" id="advisor" name="advisor" placeholder="H·ªç t√™n c·ªë v·∫•n" />
        </div>

        
        <div class="col-span-3 info-field-group">
            <label for="deliverDate">Ng√†y giao xe:</label>
            <input type="date" id="deliverDate" name="deliverDate" />
        </div>
        <div class="col-span-3 info-field-group">
            <label for="ktv">KTV:</label>
            <input type="text" id="ktv" name="ktv" placeholder="T√™n KTV" />
        </div>

        
        <div class="col-span-2 info-field-group">
            <label for="customerName">T√™n KH:</label>
            <input type="text" id="customerName" name="customerName" placeholder="T√™n kh√°ch h√†ng" />
        </div>
        <div class="col-span-2 info-field-group">
            <label for="vehicleTypeYear">Lo·∫°i xe/NSX:</label>
            <input type="text" id="vehicleTypeYear" name="vehicleTypeYear" placeholder="Lo·∫°i xe / NƒÉm SX" />
        </div>
        <div class="col-span-2 info-field-group">
            <label for="licensePlate">Bi·ªÉn s·ªë:</label>
            <input type="text" id="licensePlate" name="licensePlate" placeholder="Bi·ªÉn s·ªë" />
        </div>

        
        <div class="col-span-2 info-field-group">
            <label for="km">S·ªë km:</label>
            <input type="number" id="km" name="km" placeholder="Km" min="0" />
        </div>
        <div class="col-span-4 info-field-group">
            <label for="note">Ghi ch√∫:</label>
            <textarea id="note" name="note" placeholder="Ghi ch√∫" rows="1"></textarea>
        </div>

        
        <div class="col-span-6 info-field-group">
            <label for="other">Kh√°c:</label>
            <input type="text" id="other" name="other" placeholder="Kh√°c" />
        </div>

        <div class="col-span-6 info-field-group">
            <label for="branchSelect">Chi nh√°nh:</label>
            <select id="branchSelect" name="chiNhanh" class="info-input" required>
                <option value="">-- Ch·ªçn chi nh√°nh --</option>
                <option value="Chi Nh√°nh 1 - B√¨nh Ph∆∞·ªõc">Chi Nh√°nh 1 - B√¨nh Ph∆∞·ªõc</option>
                <option value="Chi Nh√°nh 2 - ƒê·ªìng Xo√†i">Chi Nh√°nh 2 - ƒê·ªìng Xo√†i</option>
                <option value="Chi Nh√°nh 3 - B√¨nh D∆∞∆°ng">Chi Nh√°nh 3 - B√¨nh D∆∞∆°ng</option>
            </select>
        </div>
        </section>

    
    <section class="mb-3">
        <div class="form-section-title">1. Y√™u c·∫ßu ban ƒë·∫ßu c·ªßa kh√°ch h√†ng:</div>
        <textarea name="customerRequest" placeholder="N·ªôi dung y√™u c·∫ßu ban ƒë·∫ßu" rows="2" class="w-full border border-slate-400 rounded p-1 font-normal"></textarea>
    </section>

    
    <section class="mb-2 text-white font-bold text-xs px-2 py-1 rounded" style="background-color: #003366;">
        Kho·∫£ng c√°ch m·ªói l·∫ßn b·∫£o d∆∞·ª°ng: 5.000 ho·∫∑c 3 th√°ng t√πy ƒëi·ªÅu ki·ªán n√†o t·ªõi tr∆∞·ªõc.
    </section>

    
    <section class="overflow-x-auto -mx-4 px-4">
        <table class="min-w-full border border-slate-400 border-collapse text-sm">
            <thead>
                <tr>
                    <th class="border border-slate-400 bg-yellow-300 font-semibold p-2 text-left w-64" rowspan="2" style="min-width:180px;">Ph·∫ßn G·∫ßm Tr∆∞·ªõc</th>
                    <th class="border border-slate-400 bg-yellow-300 font-semibold p-2 text-left" rowspan="2" style="min-width:280px;">Hi·ªán tr·∫°ng ki·ªÉm tra - khuy·∫øn ngh·ªã!</th>
                    <th class="border border-slate-400 checkbox-header-thay font-semibold p-2 text-center" rowspan="2" style="width: 50px;">Thay</th>
                    <th class="border border-slate-400 checkbox-header-luuy font-semibold p-2 text-center" rowspan="2" style="width: 50px;">L∆∞u √ù</th>
                    <th class="border border-slate-400 checkbox-header-tot font-semibold p-2 text-center" rowspan="2" style="width: 50px;">T·ªët</th>
                </tr>
            </thead>
            <tbody>
                
                <tr><td class="border border-slate-400 p-1 pl-3">Rotuyn l√°i trong</td><td class="border border-slate-400 p-1"><textarea name="front_rotuyn_lai_trong_status" class="w-full border border-slate-300 rounded p-1 table-textarea"></textarea></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_rotuyn_lai_trong_thay" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_rotuyn_lai_trong_luuy" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_rotuyn_lai_trong_tot" /></td></tr>
                <tr><td class="border border-slate-400 p-1 pl-3">Rotuyn l√°i ngo√†i</td><td class="border border-slate-400 p-1"><textarea name="front_rotuyn_lai_ngoai_status" class="w-full border border-slate-300 rounded p-1 table-textarea"></textarea></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_rotuyn_lai_ngoai_thay" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_rotuyn_lai_ngoai_luuy" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_rotuyn_lai_ngoai_tot" /></td></tr>
                <tr><td class="border border-slate-400 p-1 pl-3">Rotuyn tr·ª• tr√™n</td><td class="border border-slate-400 p-1"><textarea name="front_rotuyn_tru_tren_status" class="w-full border border-slate-300 rounded p-1 table-textarea"></textarea></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_rotuyn_tru_tren_thay" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_rotuyn_tru_tren_luuy" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_rotuyn_tru_tren_tot" /></td></tr>
                <tr><td class="border border-slate-400 p-1 pl-3">Rotuyn tr·ª• d∆∞·ªõi</td><td class="border border-slate-400 p-1"><textarea name="front_rotuyn_tru_duoi_status" class="w-full border border-slate-300 rounded p-1 table-textarea"></textarea></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_rotuyn_tru_duoi_thay" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_rotuyn_tru_duoi_luuy" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_rotuyn_tru_duoi_tot" /></td></tr>
                <tr><td class="border border-slate-400 p-1 pl-3">Rotuyn c√¢n b·∫±ng ( gi·∫±ng )</td><td class="border border-slate-400 p-1"><textarea name="front_rotuyn_can_bang_status" class="w-full border border-slate-300 rounded p-1 table-textarea"></textarea></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_rotuyn_can_bang_thay" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_rotuyn_can_bang_luuy" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_rotuyn_can_bang_tot" /></td></tr>
                <tr><td class="border border-slate-400 p-1 pl-3">Rotuyn pass l√°i ph·ª•</td><td class="border border-slate-400 p-1"><textarea name="front_rotuyn_pass_lai_phu_status" class="w-full border border-slate-300 rounded p-1 table-textarea"></textarea></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_rotuyn_pass_lai_phu_thay" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_rotuyn_pass_lai_phu_luuy" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_rotuyn_pass_lai_phu_tot" /></td></tr>
                <tr><td class="border border-slate-400 p-1 pl-3">Cao su ch·ªØ D</td><td class="border border-slate-400 p-1"><textarea name="front_cao_su_chu_d_status" class="w-full border border-slate-300 rounded p-1 table-textarea"></textarea></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_cao_su_chu_d_thay" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_cao_su_chu_d_luuy" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_cao_su_chu_d_tot" /></td></tr>
                <tr><td class="border border-slate-400 p-1 pl-3">Cao su ch·ªØ A tr√™n</td><td class="border border-slate-400 p-1"><textarea name="front_cao_su_chu_a_tren_status" class="w-full border border-slate-300 rounded p-1 table-textarea"></textarea></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_cao_su_chu_a_tren_thay" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_cao_su_chu_a_tren_luuy" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_cao_su_chu_a_tren_tot" /></td></tr>
                <tr><td class="border border-slate-400 p-1 pl-3">Cao su ch·ªØ A d∆∞·ªõi</td><td class="border border-slate-400 p-1"><textarea name="front_cao_su_chu_a_duoi_status" class="w-full border border-slate-300 rounded p-1 table-textarea"></textarea></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_cao_su_chu_a_duoi_thay" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_cao_su_chu_a_duoi_luuy" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_cao_su_chu_a_duoi_tot" /></td></tr>
                <tr><td class="border border-slate-400 p-1 pl-3">B·ªë th·∫Øng tr∆∞·ªõc</td><td class="border border-slate-400 p-1"><textarea name="front_bo_thang_truoc_status" class="w-full border border-slate-300 rounded p-1 table-textarea"></textarea></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_bo_thang_truoc_thay" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_bo_thang_truoc_luuy" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_bo_thang_truoc_tot" /></td></tr>
                <tr><td class="border border-slate-400 p-1 pl-3">B·∫°c ƒë·∫°n b√°nh tr∆∞·ªõc tr√°i - ph·∫£i</td><td class="border border-slate-400 p-1"><textarea name="front_bac_dan_banh_truoc_trai_phai_status" class="w-full border border-slate-300 rounded p-1 table-textarea"></textarea></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_bac_dan_banh_truoc_trai_phai_thay" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_bac_dan_banh_truoc_trai_phai_luuy" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_bac_dan_banh_truoc_trai_phai_tot" /></td></tr>
                <tr><td class="border border-slate-400 p-1 pl-3">B√°t b√®o phu·ªôc tr∆∞·ªõc</td><td class="border border-slate-400 p-1"><textarea name="front_bat_beo_phuoc_truoc_status" class="w-full border border-slate-300 rounded p-1 table-textarea"></textarea></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_bat_beo_phuoc_truoc_thay" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_bat_beo_phuoc_truoc_luuy" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_bat_beo_phuoc_truoc_tot" /></td></tr>
                <tr><td class="border border-slate-400 p-1 pl-3">TƒÉm b√¥ng phu·ªôc tr∆∞·ªõc</td><td class="border border-slate-400 p-1"><textarea name="front_tam_bong_phuoc_truoc_status" class="w-full border border-slate-300 rounded p-1 table-textarea"></textarea></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_tam_bong_phuoc_truoc_thay" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_tam_bong_phuoc_truoc_luuy" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_tam_bong_phuoc_truoc_tot" /></td></tr>
                <tr><td class="border border-slate-400 p-1 pl-3">Phu·ªôc tr∆∞·ªõc tr√°i - ph·∫£i</td><td class="border border-slate-400 p-1"><textarea name="front_phuoc_truoc_trai_phai_status" class="w-full border border-slate-300 rounded p-1 table-textarea"></textarea></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_phuoc_truoc_trai_phai_thay" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_phuoc_truoc_trai_phai_luuy" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="front_phuoc_truoc_trai_phai_tot" /></td></tr>

                
                <tr>
                    <td class="border border-slate-400 bg-yellow-300 font-bold text-left p-2" colspan="5">Ph·∫ßn G·∫ßm Sau</td>
                </tr>

                
                <tr><td class="border border-slate-400 p-1 pl-3">B·ªë th·∫Øng sau</td><td class="border border-slate-400 p-1"><textarea name="rear_bo_thang_sau_status" class="w-full border border-slate-300 rounded p-1 table-textarea"></textarea></td><td class="border border-slate-400 text-center"><input type="checkbox" name="rear_bo_thang_sau_thay" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="rear_bo_thang_sau_luuy" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="rear_bo_thang_sau_tot" /></td></tr>
                <tr><td class="border border-slate-400 p-1 pl-3">Cao su ch·ªØ D</td><td class="border border-slate-400 p-1"><textarea name="rear_cao_su_chu_d_status" class="w-full border border-slate-300 rounded p-1 table-textarea"></textarea></td><td class="border border-slate-400 text-center"><input type="checkbox" name="rear_cao_su_chu_d_thay" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="rear_cao_su_chu_d_luuy" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="rear_cao_su_chu_d_tot" /></td></tr>
                <tr><td class="border border-slate-400 p-1 pl-3">Rotuyn c√¢n b·∫±ng sau</td><td class="border border-slate-400 p-1"><textarea name="rear_rotuyn_can_bang_sau_status" class="w-full border border-slate-300 rounded p-1 table-textarea"></textarea></td><td class="border border-slate-400 text-center"><input type="checkbox" name="rear_rotuyn_can_bang_sau_thay" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="rear_rotuyn_can_bang_sau_luuy" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="rear_rotuyn_can_bang_sau_tot" /></td></tr>
                <tr><td class="border border-slate-400 p-1 pl-3">B·∫°c ƒë·∫°n b√°nh sau tr√°i - ph·∫£i</td><td class="border border-slate-400 p-1"><textarea name="rear_bac_dan_banh_sau_trai_phai_status" class="w-full border border-slate-300 rounded p-1 table-textarea"></textarea></td><td class="border border-slate-400 text-center"><input type="checkbox" name="rear_bac_dan_banh_sau_trai_phai_thay" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="rear_bac_dan_banh_sau_trai_phai_luuy" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="rear_bac_dan_banh_sau_trai_phai_tot" /></td></tr>
                <tr><td class="border border-slate-400 p-1 pl-3">Phu·ªôc sau tr√°i - ph·∫£i</td><td class="border border-slate-400 p-1"><textarea name="rear_phuoc_sau_trai_phai_status" class="w-full border border-slate-300 rounded p-1 table-textarea"></textarea></td><td class="border border-slate-400 text-center"><input type="checkbox" name="rear_phuoc_sau_trai_phai_thay" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="rear_phuoc_sau_trai_phai_luuy" /></td><td class="border border-slate-400 text-center"><input type="checkbox" name="rear_phuoc_sau_trai_phai_tot" /></td></tr>
            </tbody>
        </table>
    </section>
    
</form>

    <script>
        // Constants for Local Storage keys
        const FORM_DATA_GAM_KEY = 'phieuKiemTraGam_formData'; // Unique key for this form

        // Constants for branch locations
        const branchLocations = [
            { name: 'Chi Nh√°nh 1 - B√¨nh Ph∆∞·ªõc', lat: 11.5145974, lon: 106.8931262 },
            { name: 'Chi Nh√°nh 2 - ƒê·ªìng Xo√†i', lat: 11.537788, lon: 106.905191 },
            { name: 'Chi Nh√°nh 3 - B√¨nh D∆∞∆°ng', lat: 11.004401, lon: 106.6719367 }
        ];
        const GEOLOCATION_ERROR_RADIUS = 100; // meters

        // --- Utility Functions ---

        /**
         * Calculates the distance between two geographical points using the Haversine formula.
         * @param {number} lat1 - Latitude of point 1 in degrees.
         * @param {number} lon1 - Longitude of point 1 in degrees.
         * @param {number} lat2 - Latitude of point 2 in degrees.
         * @param {number} lon2 - Longitude of point 2 in degrees.
         * @returns {number} Distance in meters.
         */
        function getDistance(lat1, lon1, lat2, lon2) {
            const R = 6371e3; // metres
            const œÜ1 = lat1 * Math.PI / 180; // œÜ, Œª in radians
            const œÜ2 = lat2 * Math.PI / 180;
            const ŒîœÜ = (lat2 - lat1) * Math.PI / 180;
            const ŒîŒª = (lon2 - lon1) * Math.PI / 180;

            const a = Math.sin(ŒîœÜ / 2) * Math.sin(ŒîœÜ / 2) +
                      Math.cos(œÜ1) * Math.cos(œÜ2) *
                      Math.sin(ŒîŒª / 2) * Math.sin(ŒîŒª / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

            const d = R * c; // in metres
            return d;
        }

        /**
         * Determines the closest branch based on current geolocation and automatically selects it.
         */
        function getClosestBranch() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const userLat = position.coords.latitude;
                        const userLon = position.coords.longitude;
                        let closestBranch = null;
                        let minDistance = Infinity;

                        branchLocations.forEach(branch => {
                            const distance = getDistance(userLat, userLon, branch.lat, branch.lon);
                            if (distance < minDistance) {
                                minDistance = distance;
                                closestBranch = branch;
                            }
                        });

                        const branchSelect = document.getElementById('branchSelect');
                        if (closestBranch && minDistance <= GEOLOCATION_ERROR_RADIUS) { // Within 100 meters
                            branchSelect.value = closestBranch.name;
                            console.log(`T·ª± ƒë·ªông ch·ªçn chi nh√°nh: ${closestBranch.name} (kho·∫£ng c√°ch: ${minDistance.toFixed(2)}m)`);
                        } else if (closestBranch) {
                            console.log(`Chi nh√°nh g·∫ßn nh·∫•t (${closestBranch.name}) ·ªü ngo√†i b√°n k√≠nh cho ph√©p (${minDistance.toFixed(2)}m > ${GEOLOCATION_ERROR_RADIUS}m). Kh√¥ng t·ª± ƒë·ªông ch·ªçn.`);
                        } else {
                            console.log('Kh√¥ng t√¨m th·∫•y chi nh√°nh n√†o g·∫ßn nh·∫•t.');
                        }
                        saveFormDataGam(); // Save after potentially setting branch
                    },
                    (error) => {
                        console.warn(`L·ªói khi l·∫•y v·ªã tr√≠: ${error.message}`);
                        alert('Kh√¥ng th·ªÉ t·ª± ƒë·ªông x√°c ƒë·ªãnh chi nh√°nh. Vui l√≤ng ch·ªçn th·ªß c√¥ng. L·ªói: ' + error.message);
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            } else {
                console.log('Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ Geolocation.');
                alert('Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ ƒë·ªãnh v·ªã. Vui l√≤ng ch·ªçn chi nh√°nh th·ªß c√¥ng.');
            }
        }

        // Auto-resize textarea function
        function autoResizeTextarea(textarea) {
            textarea.style.height = 'auto'; // Reset height to recalculate
            textarea.style.height = (textarea.scrollHeight) + 'px'; // Set height to scrollHeight
        }

        function setInitialReceiveDate() {
            const receiveDateInput = document.getElementById('receiveDate');
            if (!receiveDateInput.value) { // Only set if empty (to avoid overwriting loaded data)
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                receiveDateInput.value = `${year}-${month}-${day}`;
            }
        }

        // --- Local Storage for Form Data ---

        function saveFormDataGam() {
            const form = document.getElementById('inspectionForm');
            if (!form) return;

            const formData = {};
            // Select all relevant form elements (inputs, textareas, selects).
            // Exclude read-only inputs that are calculated or displayed
            const inputs = form.querySelectorAll('input:not([readonly]), textarea, select');
            inputs.forEach(input => {
                if (input.name) { // Only process elements with a 'name' attribute
                    if (input.type === 'checkbox') {
                        formData[input.name] = input.checked;
                    } else if (input.type === 'radio') {
                        if (input.checked) {
                            formData[input.name] = input.value;
                        }
                    } else {
                        formData[input.name] = input.value;
                    }
                }
            });
            localStorage.setItem(FORM_DATA_GAM_KEY, JSON.stringify(formData));
            // console.log('Form data saved to localStorage:', formData); // For debugging
        }

        function loadFormDataGam() {
            const savedData = localStorage.getItem(FORM_DATA_GAM_KEY);
            if (!savedData) return;

            const formData = JSON.parse(savedData);
            const form = document.getElementById('inspectionForm');
            if (!form) return;
            for (const name in formData) {
                const elements = form.querySelectorAll(`[name="${name}"]`);
                if (elements.length > 0) {
                    elements.forEach(input => {
                        if (input.type === 'checkbox') {
                            input.checked = formData[name];
                        } else if (input.type === 'radio') {
                            if (input.value === formData[name]) {
                                input.checked = true;
                            }
                        } else {
                            input.value = formData[name];
                        }
                    });
                }
            }
            // console.log('Form data loaded from localStorage:', formData); // For debugging

            // After loading, auto-resize all textareas
            form.querySelectorAll('textarea').forEach(textarea => autoResizeTextarea(textarea));
        }

        // --- Form Submission Logic ---

        // Helper function to collect form data for submission (enhanced for checkboxes/radios)
        function collectFormDataAsUrlEncoded(formElement) {
            const formData = new FormData(formElement);
            const params = new URLSearchParams();

            params.append('formType', formElement.querySelector('[name="formType"]').value);

            for (const pair of formData.entries()) {
                params.append(pair[0], pair[1]);
            }

            // Manually add unchecked checkboxes and unselected radio groups to ensure their absence is recorded
            formElement.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                if (!checkbox.checked && !params.has(checkbox.name)) {
                    params.append(checkbox.name, ''); 
                }
            });
            const radioGroupNames = new Set();
            formElement.querySelectorAll('input[type="radio"]').forEach(radio => radioGroupNames.add(radio.name));
            radioGroupNames.forEach(groupName => {
                const checkedRadioInGroup = formElement.querySelector(`input[type="radio"][name="${groupName}"]:checked`);
                if (!checkedRadioInGroup && !params.has(groupName)) {
                    params.append(groupName, '');
                }
            });
            return params.toString();
        }

        // --- Event Listeners and Initial Setup ---

        let hasSubmitted = false; // Flag to track if form has been submitted successfully

        document.addEventListener('DOMContentLoaded', () => {
            setInitialReceiveDate(); // Set current date for receiveDate

            loadFormDataGam(); // Attempt to load saved data when page loads
            getClosestBranch(); // Attempt to get and set closest branch on load

            const form = document.getElementById('inspectionForm');
            if (form) {
                // Attach event listeners to save data on input/change
                form.addEventListener('input', (event) => {
                    saveFormDataGam();
                    // Auto-resize textarea on input
                    if (event.target.tagName === 'TEXTAREA') {
                        autoResizeTextarea(event.target);
                    }
                });
                form.addEventListener('change', saveFormDataGam); // For checkboxes, radio buttons, select elements
            }

            // Event listener for the "Send Information" button
            const submitButton = document.getElementById('submitGamFormBtn');
            if (submitButton) {
                submitButton.addEventListener('click', (event) => {
                    event.preventDefault(); // Prevent default link behavior
                    const formElement = document.getElementById('inspectionForm');
                    const scriptURL = formElement.action; // Get URL from form's action attribute

                    // Simple form validation: check if required fields are filled
                    if (!formElement.checkValidity()) {
                        alert('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß c√°c tr∆∞·ªùng b·∫Øt bu·ªôc tr∆∞·ªõc khi g·ª≠i!');
                        // Trigger browser's native validation messages
                        formElement.reportValidity(); 
                        return;
                    }

                    submitButton.disabled = true;
                    submitButton.textContent = 'ƒêang g·ª≠i...';

                    const urlEncodedData = collectFormDataAsUrlEncoded(formElement);
                    
                    fetch(scriptURL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded'
                        },
                        body: urlEncodedData
                    })
                    .then(response => response.json().then(data => {
                        if (!response.ok) {
                            throw new Error(data.message || 'L·ªói t·ª´ m√°y ch·ªß kh√¥ng x√°c ƒë·ªãnh.');
                        }
                        return data;
                    }))
                    .then(data => {
                        if (data.result === 'success') {
                            alert('‚úÖ G·ª≠i th√¥ng tin th√†nh c√¥ng! B·∫°n c√≥ th·ªÉ in phi·∫øu.');
                            console.log('D·ªØ li·ªáu ƒë√£ g·ª≠i:', data.row);
                            hasSubmitted = true; // Set flag to true
                            // *** D·ªÆ LI·ªÜU KH√îNG B·ªä X√ìA SAU KHI G·ª¨I TH√ÄNH C√îNG ***
                            // localStorage.removeItem(FORM_DATA_GAM_KEY); // KH√îNG X√ìA D·ªÆ LI·ªÜU T·∫†I ƒê√ÇY
                            // formElement.reset(); // KH√îNG RESET FORM T·∫†I ƒê√ÇY
                        } else {
                            alert('‚ùå Kh√¥ng g·ª≠i ƒë∆∞·ª£c, Kh√¥ng bi·∫øt h·ªèi ai: ' + (data.message || 'L·ªói kh√¥ng x√°c ƒë·ªãnh t·ª´ Apps Script.'));
                            console.error('L·ªói t·ª´ Apps Script:', data.message);
                        }
                    })
                    .catch(error => {
                        alert('‚ùå C√≥ l·ªói x·∫£y ra khi g·ª≠i. Vui l√≤ng ki·ªÉm tra console (F12) ƒë·ªÉ bi·∫øt chi ti·∫øt.');
                        console.error('L·ªói Fetch ho·∫∑c ph·∫£n h·ªìi kh√¥ng h·ª£p l·ªá:', error);
                    })
                    .finally(() => {
                        submitButton.disabled = false;
                        submitButton.textContent = 'üì§ G·ª≠i Th√¥ng Tin';
                    });
                });
            }

            // Event listener for the "Print" button
            const printButton = document.getElementById('printButton');
            if (printButton) {
                printButton.addEventListener('click', (event) => {
                    event.preventDefault(); // Prevent default link behavior
                    const formElement = document.getElementById('inspectionForm');
                    if (!hasSubmitted) {
                        alert('Vui l√≤ng nh·∫•n "G·ª≠i Th√¥ng Tin" tr∆∞·ªõc khi in phi·∫øu!');
                    } else {
                        window.print();
                        // *** X√ìA D·ªÆ LI·ªÜU V√Ä RESET FORM SAU KHI ƒê√É IN ***
                        localStorage.removeItem(FORM_DATA_GAM_KEY); 
                        formElement.reset(); 
                        setInitialReceiveDate(); // Reset receive date
                        formElement.querySelectorAll('textarea').forEach(textarea => autoResizeTextarea(textarea)); // Reset textarea sizes
                        hasSubmitted = false; // Reset flag for next form fill-out
                    }
                });
            }

            // Initial auto-resize for all textareas on load
            // This is important to correctly size textareas if data is loaded from localStorage
            form.querySelectorAll('textarea').forEach(textarea => autoResizeTextarea(textarea));
        });
    </script>
</body>
</html>
