<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Phiếu Kiểm Tra Gầm</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* CSS của bạn vẫn được giữ nguyên, không có gì thay đổi ở đây */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f3f4f6; padding: 1rem; color: #212529; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
        .table-header-bg { background-color: #fde68a; }
        .checkbox-header-thay { background-color: #ea580c; color: white; }
        .checkbox-header-luuy { background-color: #e0e7ff; color: #1e3a8a; }
        .checkbox-header-tot { background-color: #22c55e; color: white; }
        .form-section-title { font-weight: 700; border-bottom: 1px solid #334155; padding-bottom: 0.1rem; margin-bottom: 0.4rem; font-size: 1.1rem; color: #1e293b; }
        th, td { vertical-align: top; padding: 0.2rem 0.4rem; border-bottom: 1px solid #94a3b8; }
        label.checkbox-label { cursor: pointer; user-select: none; }
        textarea { resize: vertical; padding: 0.15rem 0.3rem; border: 1px solid #cbd5e1; border-radius: 0.25rem; font-family: inherit; width: 100%; min-height: 28px; overflow-y: hidden; box-sizing: border-box; white-space: pre-wrap; word-wrap: break-word; }
        input[type="text"], input[type="date"], input[type="time"], input[type="number"], select { border: 1px solid #cbd5e1; border-radius: 0.25rem; padding: 0.15rem 0.3rem; font-family: inherit; box-sizing: border-box; min-height: 24px; width: 100%; }
        .logo-container { width: 70px; height: 70px; }
        .logo-container img { width: 70px; height: 70px; }
        .info-field-group { display: flex; align-items: center; gap: 0.2rem; }
        .info-field-group label { flex-shrink: 0; white-space: nowrap; font-weight: bold; min-width: 40px; }
        .info-field-group input, .info-field-group textarea, .info-field-group select { flex-grow: 1; min-width: 0; }
        .table-textarea { resize: none; overflow-y: hidden; min-height: 22px; line-height: 1.2; padding: 0.1rem 0.2rem; border: 1px solid #cbd5e1; border-radius: 0.25rem; box-sizing: border-box; white-space: pre-wrap; word-wrap: break-word; width: 95%; }
        textarea[name="customerRequest"] { width: 100%; min-height: 50px; resize: vertical; box-sizing: border-box; white-space: pre-wrap; word-wrap: break-word; }
        @media print { body { background: white; padding: 0 !important; margin: 0 !important; font-size: 7.5pt; line-height: 1.1 !important; } .no-print { display: none !important; } table { page-break-inside: avoid; width: 100% !important; margin: 0 !important; } textarea, input, select { border: 1px solid black !important; box-shadow: none !important; padding: 0.03rem 0.08rem !important; min-height: unset !important; height: auto !important; overflow: visible !important; width: auto !important; flex-grow: 1 !important; flex-shrink: 1 !important; box-sizing: border-box !important; white-space: pre-wrap !important; word-wrap: break-word !important; } textarea[name="customerRequest"] { min-height: 40px !important; padding: 0.1rem 0.2rem !important; width: 100% !important; max-width: 100% !important; } .table-textarea { min-height: 16px !important; height: auto !important; overflow: visible !important; line-height: 1 !important; padding: 0.02rem 0.05rem !important; width: 100% !important; max-width: 100% !important; } section.grid { gap-x: 0.3rem !important; gap-y: 0.05rem !important; margin-bottom: 0.3rem !important; } .info-field-group label { min-width: 35px !important; margin-right: 0.1rem !important; } header { margin-bottom: 0.2rem !important; padding-bottom: 0.2rem !important; } h1 { font-size: 1.0rem !important; } .form-section-title { font-size: 0.75rem !important; margin-bottom: 0.05rem !important; padding-bottom: 0.03rem !important; border-bottom-width: 1px !important; } .max-w-6xl { max-width: 100% !important; box-shadow: none !important; border: none !important; padding: 0 !important; margin: 0 !important; } .p-1, .p-2, .p-3, .p-4, .px-3, .py-1, .pl-3 { padding: 0.03rem !important; } .mb-6 { margin-bottom: 0.2rem !important; } .mt-6 { margin-top: 0.2rem !important; } .rounded, .rounded-lg { border-radius: 0 !important; } table th, table td { padding: 0.03rem 0.08rem !important; border: 1px solid black !important; vertical-align: top !important; } table th:nth-child(1), table td:nth-child(1) { width: 120px !important; min-width: 120px !important; } table th:nth-child(2), table td:nth-child(2) { width: 400px !important; min-width: 400px !important; } table th:nth-child(3), table td:nth-child(3), table th:nth-child(4), table td:nth-child(4), table th:nth-child(5), table td:nth-child(5) { width: 20px !important; min-width: 20px !important; max-width: 20px !important; } .text-sm { font-size: 0.7rem !important; } .text-slate-700, .text-slate-800, .text-slate-900 { color: black !important; } strong { font-weight: bold !important; } p { margin: 0.05rem 0 !important; } section.note-section { padding: 0.1rem 0.2rem !important; min-height: unset !important; height: 50px !important; margin-top: 0.1rem !important; font-size: 0.65rem !important; line-height: 1 !important; border: 1px solid #ffc107 !important; background-color: #fff3cd !important; } section.note-section p { margin: 0 !important; } header .logo-container { width: 50px !important; height: 50px !important; } header .logo-container img { width: 50px !important; height: 50px !important; } header h1 { font-size: 1.0rem !important; } header div[style="width: 80px;"] { width: 50px !important; } .mb-2 { margin-bottom: 0.15rem !important; } .mb-3 { margin-bottom: 0.25rem !important; }}
    </style>
</head>
<body>
    
    <div class="no-print bg-gray-800 text-white p-3 mb-6 flex justify-center space-x-4 rounded-lg shadow-md">
        <a href="#" id="printButton" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition duration-300 ease-in-out">In Phiếu</a>
        <a href="#" id="submitGamFormBtn" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded transition duration-300 ease-in-out">Gửi Thông Tin</a>
        </div>
    
    <form id="inspectionForm" class="max-w-6xl mx-auto bg-white p-4 shadow-lg rounded-lg" autocomplete="off">
        <input type="hidden" name="formType" value="PhieuKiemTraGam">
        
        <header class="mb-4 border-b border-slate-300 pb-3 flex flex-wrap items-center justify-between">
            <div class="logo-container mr-3 flex-shrink-0"><img src="https://longvt89.github.io/phieukiemtra/logophilong.jpg" alt="Logo" style="background-color:#e0f2fe; border-radius: 10px; object-fit: contain;"></div>
            <h1 class="text-2xl font-extrabold text-slate-900 flex-grow text-center min-w-[250px]">PHIẾU KIỂM TRA GẦM</h1>
            <div style="width: 70px;"></div>
        </header>
        <section class="grid grid-cols-6 gap-x-2 gap-y-1 mb-3 text-sm text-slate-800">
            <div class="col-span-3 info-field-group"><label for="receiveDate">Ngày nhận xe:</label><input type="date" id="receiveDate" name="receiveDate" required></div>
            <div class="col-span-3 info-field-group"><label for="advisor">Cố vấn DV:</label><input type="text" id="advisor" name="advisor" placeholder="Họ tên cố vấn"></div>
            <div class="col-span-3 info-field-group"><label for="deliverDate">Ngày giao xe:</label><input type="date" id="deliverDate" name="deliverDate"></div>
            <div class="col-span-3 info-field-group"><label for="ktv">KTV:</label><input type="text" id="ktv" name="ktv" placeholder="Tên KTV"></div>
            <div class="col-span-2 info-field-group"><label for="customerName">Tên KH:</label><input type="text" id="customerName" name="customerName" placeholder="Tên khách hàng"></div>
            <div class="col-span-2 info-field-group"><label for="vehicleTypeYear">Loại xe/NSX:</label><input type="text" id="vehicleTypeYear" name="vehicleTypeYear" placeholder="Loại xe / Năm SX"></div>
            <div class="col-span-2 info-field-group"><label for="licensePlate">Biển số:</label><input type="text" id="licensePlate" name="licensePlate" placeholder="Biển số"></div>
            <div class="col-span-2 info-field-group"><label for="km">Số km:</label><input type="number" id="km" name="km" placeholder="Km" min="0"></div>
            <div class="col-span-4 info-field-group"><label for="note">Ghi chú:</label><textarea id="note" name="note" placeholder="Ghi chú" rows="1"></textarea></div>
            <div class="col-span-6 info-field-group"><label for="other">Khác:</label><input type="text" id="other" name="other" placeholder="Khác"></div>
            <div class="col-span-6 info-field-group">
                <label for="branchSelect">Chi nhánh:</label>
                <select id="branchSelect" name="chiNhanh" required>
                    <option value="">-- Chọn chi nhánh --</option>
                    <option value="Chi Nhánh 1 - Bình Phước">Chi Nhánh 1 - Bình Phước</option>
                    <option value="Chi Nhánh 2 - Đồng Xoài">Chi Nhánh 2 - Đồng Xoài</option>
                    <option value="Chi Nhánh 3 - Bình Dương">Chi Nhánh 3 - Bình Dương</option>
                </select>
            </div>
        </section>
        <section class="mb-3">
            <div class="form-section-title">1. Yêu cầu ban đầu của khách hàng:</div>
            <textarea name="customerRequest" placeholder="Nội dung yêu cầu ban đầu" rows="2" class="w-full border border-slate-400 rounded p-1 font-normal"></textarea>
        </section>
        <section class="mb-2 text-white font-bold text-xs px-2 py-1 rounded" style="background-color: #003366;">Khoảng cách mỗi lần bảo dưỡng: 5.000 hoặc 3 tháng tùy điều kiện nào tới trước.</section>
        <section class="overflow-x-auto -mx-4 px-4">
            <table class="min-w-full border border-slate-400 border-collapse text-sm">
                <thead>
                    <tr><th rowspan="2">Phần Gầm Trước</th><th rowspan="2">Hiện trạng kiểm tra - khuyến nghị!</th><th rowspan="2">Thay</th><th rowspan="2">Lưu Ý</th><th rowspan="2">Tốt</th></tr>
                </thead>
                <tbody>
                    <tr><td>Rotuyn lái trong</td><td><textarea name="front_rotuyn_lai_trong_status" class="table-textarea"></textarea></td><td><input type="checkbox" name="front_rotuyn_lai_trong_thay"></td><td><input type="checkbox" name="front_rotuyn_lai_trong_luuy"></td><td><input type="checkbox" name="front_rotuyn_lai_trong_tot"></td></tr>
                    <tr><td>Rotuyn lái ngoài</td><td><textarea name="front_rotuyn_lai_ngoai_status" class="table-textarea"></textarea></td><td><input type="checkbox" name="front_rotuyn_lai_ngoai_thay"></td><td><input type="checkbox" name="front_rotuyn_lai_ngoai_luuy"></td><td><input type="checkbox" name="front_rotuyn_lai_ngoai_tot"></td></tr>
                    <tr><td>Rotuyn trụ trên</td><td><textarea name="front_rotuyn_tru_tren_status" class="table-textarea"></textarea></td><td><input type="checkbox" name="front_rotuyn_tru_tren_thay"></td><td><input type="checkbox" name="front_rotuyn_tru_tren_luuy"></td><td><input type="checkbox" name="front_rotuyn_tru_tren_tot"></td></tr>
                    <tr><td>Rotuyn trụ dưới</td><td><textarea name="front_rotuyn_tru_duoi_status" class="table-textarea"></textarea></td><td><input type="checkbox" name="front_rotuyn_tru_duoi_thay"></td><td><input type="checkbox" name="front_rotuyn_tru_duoi_luuy"></td><td><input type="checkbox" name="front_rotuyn_tru_duoi_tot"></td></tr>
                    <tr><td>Rotuyn cân bằng ( giằng )</td><td><textarea name="front_rotuyn_can_bang_status" class="table-textarea"></textarea></td><td><input type="checkbox" name="front_rotuyn_can_bang_thay"></td><td><input type="checkbox" name="front_rotuyn_can_bang_luuy"></td><td><input type="checkbox" name="front_rotuyn_can_bang_tot"></td></tr>
                    <tr><td>Rotuyn pass lái phụ</td><td><textarea name="front_rotuyn_pass_lai_phu_status" class="table-textarea"></textarea></td><td><input type="checkbox" name="front_rotuyn_pass_lai_phu_thay"></td><td><input type="checkbox" name="front_rotuyn_pass_lai_phu_luuy"></td><td><input type="checkbox" name="front_rotuyn_pass_lai_phu_tot"></td></tr>
                    <tr><td>Cao su chữ D</td><td><textarea name="front_cao_su_chu_d_status" class="table-textarea"></textarea></td><td><input type="checkbox" name="front_cao_su_chu_d_thay"></td><td><input type="checkbox" name="front_cao_su_chu_d_luuy"></td><td><input type="checkbox" name="front_cao_su_chu_d_tot"></td></tr>
                    <tr><td>Cao su chữ A trên</td><td><textarea name="front_cao_su_chu_a_tren_status" class="table-textarea"></textarea></td><td><input type="checkbox" name="front_cao_su_chu_a_tren_thay"></td><td><input type="checkbox" name="front_cao_su_chu_a_tren_luuy"></td><td><input type="checkbox" name="front_cao_su_chu_a_tren_tot"></td></tr>
                    <tr><td>Cao su chữ A dưới</td><td><textarea name="front_cao_su_chu_a_duoi_status" class="table-textarea"></textarea></td><td><input type="checkbox" name="front_cao_su_chu_a_duoi_thay"></td><td><input type="checkbox" name="front_cao_su_chu_a_duoi_luuy"></td><td><input type="checkbox" name="front_cao_su_chu_a_duoi_tot"></td></tr>
                    <tr><td>Bố thắng trước</td><td><textarea name="front_bo_thang_truoc_status" class="table-textarea"></textarea></td><td><input type="checkbox" name="front_bo_thang_truoc_thay"></td><td><input type="checkbox" name="front_bo_thang_truoc_luuy"></td><td><input type="checkbox" name="front_bo_thang_truoc_tot"></td></tr>
                    <tr><td>Bạc đạn bánh trước trái - phải</td><td><textarea name="front_bac_dan_banh_truoc_trai_phai_status" class="table-textarea"></textarea></td><td><input type="checkbox" name="front_bac_dan_banh_truoc_trai_phai_thay"></td><td><input type="checkbox" name="front_bac_dan_banh_truoc_trai_phai_luuy"></td><td><input type="checkbox" name="front_bac_dan_banh_truoc_trai_phai_tot"></td></tr>
                    <tr><td>Bát bèo phuộc trước</td><td><textarea name="front_bat_beo_phuoc_truoc_status" class="table-textarea"></textarea></td><td><input type="checkbox" name="front_bat_beo_phuoc_truoc_thay"></td><td><input type="checkbox" name="front_bat_beo_phuoc_truoc_luuy"></td><td><input type="checkbox" name="front_bat_beo_phuoc_truoc_tot"></td></tr>
                    <tr><td>Tăm bông phuộc trước</td><td><textarea name="front_tam_bong_phuoc_truoc_status" class="table-textarea"></textarea></td><td><input type="checkbox" name="front_tam_bong_phuoc_truoc_thay"></td><td><input type="checkbox" name="front_tam_bong_phuoc_truoc_luuy"></td><td><input type="checkbox" name="front_tam_bong_phuoc_truoc_tot"></td></tr>
                    <tr><td>Phuộc trước trái - phải</td><td><textarea name="front_phuoc_truoc_trai_phai_status" class="table-textarea"></textarea></td><td><input type="checkbox" name="front_phuoc_truoc_trai_phai_thay"></td><td><input type="checkbox" name="front_phuoc_truoc_trai_phai_luuy"></td><td><input type="checkbox" name="front_phuoc_truoc_trai_phai_tot"></td></tr>
                    <tr><td colspan="5">Phần Gầm Sau</td></tr>
                    <tr><td>Bố thắng sau</td><td><textarea name="rear_bo_thang_sau_status" class="table-textarea"></textarea></td><td><input type="checkbox" name="rear_bo_thang_sau_thay"></td><td><input type="checkbox" name="rear_bo_thang_sau_luuy"></td><td><input type="checkbox" name="rear_bo_thang_sau_tot"></td></tr>
                    <tr><td>Cao su chữ D</td><td><textarea name="rear_cao_su_chu_d_status" class="table-textarea"></textarea></td><td><input type="checkbox" name="rear_cao_su_chu_d_thay"></td><td><input type="checkbox" name="rear_cao_su_chu_d_luuy"></td><td><input type="checkbox" name="rear_cao_su_chu_d_tot"></td></tr>
                    <tr><td>Rotuyn cân bằng sau</td><td><textarea name="rear_rotuyn_can_bang_sau_status" class="table-textarea"></textarea></td><td><input type="checkbox" name="rear_rotuyn_can_bang_sau_thay"></td><td><input type="checkbox" name="rear_rotuyn_can_bang_sau_luuy"></td><td><input type="checkbox" name="rear_rotuyn_can_bang_sau_tot"></td></tr>
                    <tr><td>Bạc đạn bánh sau trái - phải</td><td><textarea name="rear_bac_dan_banh_sau_trai_phai_status" class="table-textarea"></textarea></td><td><input type="checkbox" name="rear_bac_dan_banh_sau_trai_phai_thay"></td><td><input type="checkbox" name="rear_bac_dan_banh_sau_trai_phai_luuy"></td><td><input type="checkbox" name="rear_bac_dan_banh_sau_trai_phai_tot"></td></tr>
                    <tr><td>Phuộc sau trái - phải</td><td><textarea name="rear_phuoc_sau_trai_phai_status" class="table-textarea"></textarea></td><td><input type="checkbox" name="rear_phuoc_sau_trai_phai_thay"></td><td><input type="checkbox" name="rear_phuoc_sau_trai_phai_luuy"></td><td><input type="checkbox" name="rear_phuoc_sau_trai_phai_tot"></td></tr>
                </tbody>
            </table>
        </section>
        
    </form>

    <script>
        // *** TOÀN BỘ PHẦN JAVASCRIPT ĐƯỢC THAY THẾ BẰNG PHIÊN BẢN MỚI ***

        // URL của Google Apps Script (bạn không cần thay đổi)
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzE44UQR_Mu1M9vAxnY6SmrHq-2hTPIr1I-0rpTztwPoN-PoEL0psVLvXb8HY746mRz/exec";
        const FORM_DATA_GAM_KEY = 'phieuKiemTraGam_formData';

        // --- CÁC HÀM TIỆN ÍCH (Giữ nguyên) ---
        function autoResizeTextarea(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = (textarea.scrollHeight) + 'px';
        }

        function setInitialReceiveDate() {
            const receiveDateInput = document.getElementById('receiveDate');
            if (!receiveDateInput.value) {
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                receiveDateInput.value = `${year}-${month}-${day}`;
            }
        }

        // --- LƯU VÀ TẢI DỮ LIỆU FORM (Giữ nguyên) ---
        function saveFormDataGam() {
            const form = document.getElementById('inspectionForm');
            if (!form) return;
            const formData = {};
            const inputs = form.querySelectorAll('input:not([readonly]), textarea, select');
            inputs.forEach(input => {
                if (input.name) {
                    if (input.type === 'checkbox') {
                        formData[input.name] = input.checked;
                    } else {
                        formData[input.name] = input.value;
                    }
                }
            });
            localStorage.setItem(FORM_DATA_GAM_KEY, JSON.stringify(formData));
        }

        function loadFormDataGam() {
            const savedData = localStorage.getItem(FORM_DATA_GAM_KEY);
            if (!savedData) return;
            const formData = JSON.parse(savedData);
            const form = document.getElementById('inspectionForm');
            if (!form) return;
            for (const name in formData) {
                const elements = form.querySelectorAll(`[name="${name}"]`);
                if (elements.length > 0) {
                    elements.forEach(input => {
                        if (input.type === 'checkbox') {
                            input.checked = formData[name];
                        } else {
                            input.value = formData[name];
                        }
                    });
                }
            }
            form.querySelectorAll('textarea').forEach(textarea => autoResizeTextarea(textarea));
        }

        // --- LOGIC GỬI FORM (ĐÂY LÀ PHẦN THAY ĐỔI CHÍNH) ---

        /**
         * THAY ĐỔI: Thu thập dữ liệu form dưới dạng đối tượng JSON.
         * Phương thức này ổn định và đáng tin cậy hơn.
         * @param {HTMLFormElement} formElement - Phần tử form để thu thập dữ liệu.
         * @returns {Object} - Một đối tượng JSON chứa tất cả dữ liệu form.
         */
        function collectFormDataAsJSON(formElement) {
            const formData = new FormData(formElement);
            const data = {};
            // Chuyển đổi FormData thành đối tượng key-value
            for (const [key, value] of formData.entries()) {
                data[key] = value;
            }
            
            // Xử lý các checkbox không được check (FormData sẽ bỏ qua chúng)
            // Ta cần thêm chúng vào để đảm bảo các cột trong Google Sheet không bị lệch
            formElement.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                if (!checkbox.checked) {
                    // Nếu một checkbox không được tick, ta gán giá trị rỗng cho nó
                    data[checkbox.name] = '';
                }
            });
            return data;
        }

        let hasSubmitted = false;

        document.addEventListener('DOMContentLoaded', () => {
            setInitialReceiveDate();
            loadFormDataGam();

            const form = document.getElementById('inspectionForm');
            if (form) {
                form.addEventListener('input', (event) => {
                    saveFormDataGam();
                    if (event.target.tagName === 'TEXTAREA') {
                        autoResizeTextarea(event.target);
                    }
                });
                form.addEventListener('change', saveFormDataGam);
            }

            const submitButton = document.getElementById('submitGamFormBtn');
            if (submitButton) {
                submitButton.addEventListener('click', (event) => {
                    event.preventDefault();
                    const formElement = document.getElementById('inspectionForm');

                    if (!formElement.checkValidity()) {
                        alert('Vui lòng điền đầy đủ các trường bắt buộc (Ngày nhận xe, Chi nhánh) trước khi gửi!');
                        formElement.reportValidity();
                        return;
                    }

                    submitButton.disabled = true;
                    submitButton.textContent = 'Đang gửi...';

                    // THAY ĐỔI: Sử dụng hàm mới để lấy dữ liệu JSON
                    const jsonData = collectFormDataAsJSON(formElement);
                    
                    // THAY ĐỔI: Gửi dữ liệu dưới dạng chuỗi JSON
                    fetch(SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors', // Thêm dòng này để tránh lỗi CORS khi script chuyển hướng
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(jsonData)
                    })
                    .then(response => {
                        // Vì `no-cors` sẽ trả về một `opaque` response, chúng ta không thể đọc được nội dung
                        // Thay vào đó, chúng ta sẽ giả định thành công và thông báo cho người dùng.
                        // Việc ghi log lỗi vẫn diễn ra trên server (code.gs).
                        alert('✅ Yêu cầu gửi đã được thực hiện! Vui lòng kiểm tra sheet để xác nhận dữ liệu.');
                        console.log('Dữ liệu đã gửi (dạng JSON):', jsonData);
                        hasSubmitted = true;
                    })
                    .catch(error => {
                        // Lỗi này thường là lỗi mạng, không phải lỗi từ server
                        alert('❌ Có lỗi mạng xảy ra khi gửi. Vui lòng kiểm tra kết nối internet.');
                        console.error('Lỗi Fetch:', error);
                    })
                    .finally(() => {
                        submitButton.disabled = false;
                        submitButton.textContent = 'Gửi Thông Tin';
                    });
                });
            }
            
            const printButton = document.getElementById('printButton');
            if (printButton) {
                printButton.addEventListener('click', (event) => {
                    event.preventDefault();
                    if (!hasSubmitted) {
                        alert('Vui lòng nhấn "Gửi Thông Tin" trước khi in phiếu!');
                    } else {
                        window.print();
                        // Reset form sau khi in
                        localStorage.removeItem(FORM_DATA_GAM_KEY);
                        document.getElementById('inspectionForm').reset();
                        setInitialReceiveDate();
                        document.querySelectorAll('textarea').forEach(autoResizeTextarea);
                        hasSubmitted = false;
                    }
                });
            }
        });
    </script>
</body>
</html>
